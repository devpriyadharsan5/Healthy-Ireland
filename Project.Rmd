---
title: "Healthy Ireland Project"
author: "Devpriyadharsan Balan Saravanan 22250355"
output:
  html_document: default
---

```{r}
suppressWarnings(library(haven))
suppressWarnings(library(dplyr))
suppressWarnings(library(magrittr))
suppressWarnings(library(knitr))
suppressWarnings(library(lattice))
suppressWarnings(library(tidyverse))
suppressWarnings(library(likert))
suppressWarnings(library(MASS))
suppressWarnings(library(psych))
suppressWarnings(library(viridis))
suppressWarnings(library(ggplot2))
suppressWarnings(library(here))
suppressWarnings(library(flextable))
suppressWarnings(library(devtools))
suppressWarnings(library(dplyr))
suppressWarnings(library(labelled))
suppressWarnings(library(foreign))
suppressWarnings(library(questionr))
suppressWarnings(library(survey))
suppressWarnings(library(tibble))
suppressWarnings(library(psych)) #masks ggpplot2:: %+%, alpha
suppressWarnings(library(GGally)) #masks dbplyr::nasa
suppressWarnings(library(kableExtra)) #masks dplyr::group_rows
suppressWarnings(library(MVN))
suppressWarnings(library(likert))
suppressWarnings(library(plyr))
```


```{r}
data <- read_sav("0021-04_healthy_ireland_2018.sav")
#View(data)
```


```{r}
df1 <- data[c("q6","q7","q8","slq9b","q10","q11","q13","q340","q348","q349")]

df2 <- data[c("q14","exq15","exq18")]

df3 <- data[c("spq1","q52","q55","q58","q120","q205","q208","q308")]

df4 <- data[c("q229","q230","q231","q232","q233","q330_1","q330_2","q330_3")]

df5 <- data[c("q63b","lho","key1","ageclass","countbirth")]
```


```{r}
#write.table(df1, file = "df1.csv",sep = "\t", row.names = F)

#write_sav(df1, "df1.sav")  

newdata <- cbind(df1, df2,df3,df4,df5) 

#n <- cbind(df1new, df2new,df3,df4,df5) 

#write_sav(newdata, "newdata.sav") 

```



```{r}
val_labels(df2) #gives options
```


```{r}
var_label(df2) #gives questions
```

```{r}
glimpse(df2)
```


```{r}
# Continuous variables
summary(df2)
```


```{r}
#always use n1

n1<- to_factor((newdata), drop_unused_labels=TRUE, ordered=TRUE)

table(n1$q6,exclude = NULL)
```

```{r}
table(n1$q7,exclude = NULL)
```

```{r}
barplot(table(n1$q52, n1$ageclass, exclude = NULL))
```

```{r}
#proportions

ggplot(data = n1) +
  geom_bar(mapping = aes(x = ageclass, fill=q52) , position = "fill") +
  scale_fill_brewer(palette="Paired")+
  theme_minimal()
table(data$ageclass )
table(data$agecls2 )
table(data$agecls3 )


n1 %>% dplyr::count(ageclass)
```


```{r}

n1|> group_by(ageclass) |> 
  dplyr::summarise(N=n(),q6=q6) |> 
  group_by(ageclass,q6) |> 
  dplyr::summarise(n(),N = N)


n1|> group_by(ageclass,q6) |> 
  dplyr::summarise(count=n()) |> 
  ungroup() |> group_by(ageclass) |> 
  dplyr::summarise(perc=count/sum(count)*100)

ggplot(data = n1) +
  geom_bar(mapping = aes(x = ageclass, fill=q6)) 

```


```{r}
ggplot(data = n1,na.rm=TRUE) +
  geom_bar(aes(x = ageclass, fill=q6), position="dodge") +
  scale_fill_manual(values=c("#B6300C",
                             "#20A220",
                             "#2C8EE5"))+
  scale_fill_discrete(name = "Do you smoke tobacco products?")+
  facet_wrap(~q52) 
 
```



##1. What percentage of the population smokes and how does this vary by age
```{r}
# Recode smoking variable to combine "Yes, daily" and "Yes, occasionally"


s <- n1 %>% 
  dplyr::group_by(q6, ageclass) %>% 
  dplyr::summarise(count = n()) |>
  drop_na() |>
  ungroup() %>%
  group_by(ageclass) %>%
  dplyr::mutate(perc = count/sum(count)*100) %>%
  dplyr::select(ageclass, q6, count)


s$q6 <- ifelse(s$q6 %in% c("Yes, daily", "Yes, occasionally"), "Yes", "No")

# Group by ageclass and smoking status, and summarize the count of individuals in each group
smoking_by_age <- s %>% 
  group_by(ageclass, q6) %>% 
  dplyr::summarise(count = n(),ageclass=ageclass)

# Calculate the percentage of individuals in each group
smoking_by_age <- 
  s %>% 
  group_by(ageclass) %>% 
  mutate(perc = count/sum(count)*100)

# Plot the results
ggplot(smoking_by_age, aes(x = ageclass, y = perc, fill = q6)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Age", y = "Percentage of population", fill = "Smoking status") +
  ggtitle("Smoking by Age") +
  theme(plot.title = element_text(hjust = 0.5))

```

In all the 4 age categories, majority of them don't smoke. majority ofthe smokers are in 25-44 years (7.76%) followed by 45-64 years (6.31%). looks like teenagers and people over 65 are more health conscious.



##2. What percentage of the population smokes and how does this vary by gender

```{r}

n1$q6<- ifelse(n1$q6 %in% c("Yes, daily", "Yes, occasionally"), "Yes", "No")

# Select the required variables
df_smoking <- n1[c("q6", "q52")]

# Group the data by smoking and gender, and count the number of observations in each group
grouped_data <- df_smoking |>
  group_by(q6, q52) |>
  dplyr::summarise(count = n()) |>
  ungroup()


# Calculate the total number of observations (excluding missing values)
total_obs <- sum(grouped_data$count)

# Calculate the percentage of the population that smokes, by gender
smoking_perc <- grouped_data |>
  mutate(perc = count / total_obs * 100) 

ggplot(smoking_perc, aes(x = q52, y = perc, fill = q6)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Gender", y = "Percentage", fill = "Smoking") +
  ggtitle("Percentage of population that smokes, by gender")
```

as we said earlier, most of them dont smoke. percentage of male who smoke (9.47%) is almost equal to those with women (9.05%)




##3. What percentage of the population smokes and how does this vary by socioeconomic status?
```{r}

d2 <- n1[c("q6", "key1")]

# Calculate the percentage of smokers by socioeconomic status
smoking_by_ses <- d2 %>%
  group_by(key1, q6) %>%
  dplyr::summarize(count = n()) %>%
  group_by(key1) %>%
  mutate(perc = count / sum(count) * 100) 

# Create a bar plot
ggplot(smoking_by_ses, aes(x = key1, y = perc, fill = q6)) +
  geom_bar(stat = "identity", position="dodge") +
  scale_fill_discrete(name = "Do You smoke?") +
  labs(x = "Socioeconomic Status", y = "Percentage of Smokers")+
  theme(axis.text.x = element_text(angle = 90))+scale_x_discrete(labels = function(x) 
    stringr::str_wrap(x, width = 15))+
       ggtitle ( "Smoking Rates by Socioeconomic Status")


```

##4 people from which region smoke the most?
```{r}
d4 <- n1[c("q6", "lho")]

# Calculate the percentage of alcoholic by 
smoke_region <- d4 %>%
  group_by(lho,q6) %>%
  drop_na() |>
  dplyr::summarize(count = n()) %>%
  group_by(q6) %>%
  mutate(perc = count / sum(count) * 100) 

# Create a bar plot
ggplot(smoke_region, aes(x = lho, y = perc, fill = q6)) +
  geom_bar(stat = "identity", position="dodge") +
  scale_fill_discrete(name = "Do you Smoke?") +
  labs(x = "County", y = "Percentage")+
  theme(axis.text.x = element_text(angle = 90))+
  ggtitle ( "Region (Smokers)")
```


##5 smokers from various countries
```{r}

d5 <- n1[c("q6", "countbirth")]

# Calculate the percentage of alcoholic by 
smoke_country <- d5 %>%
  group_by(countbirth,q6) %>%
  drop_na() |>
  dplyr::summarize(count = n()) %>%
  group_by(q6) %>%
  mutate(perc = count / sum(count) * 100) 

# Create a bar plot
ggplot(smoke_country, aes(x = countbirth, y = perc, fill = q6)) +
  geom_bar(stat = "identity", position="dodge") +
  scale_fill_discrete(name = "Do you Smoke?") +
  labs(x = "County", y = "Percentage")+
  theme(axis.text.x = element_text(angle = 30,hjust=1))+
  ggtitle ( "Smokers from different countries")
```




##6 What percentage of the population consumes alcohol, and how does this vary by age
```{r}
d3 <- n1[c("q14", "ageclass")]

# Calculate the percentage of alcoholic by 
alcohol_age <- d3 %>%
  group_by(ageclass,q14) %>%
  drop_na() |>
  dplyr::summarize(count = n()) %>%
  group_by(q14) %>%
  mutate(perc = count / sum(count) * 100) 

# Create a bar plot
ggplot(alcohol_age, aes(x = ageclass, y = perc, fill = q14)) +
  geom_bar(stat = "identity", position="dodge") +
  scale_fill_discrete(name = "Do you consume alcohol?") +
  labs(x = "Age", y = "Percentage")+
  ggtitle ( "Alcohol consumption by age")
```


majority of people are consuming alcohol than smoking. people from age 25-44 are leading consumers with 28.13 % followed by age 45-64 with 26.61%. it is shocking that people above 65 (19.21%) also consume alcohol.


##7 What percentage of the population consumes alcohol, and how does this vary by gender
```{r}
d7 <- n1[c("q14", "q52")]

# Calculate the percentage of alcoholic by 
alcohol_gender <- d7 %>%
  group_by(q14,q52) %>%
  drop_na() |>
  dplyr::summarize(count = n()) %>%
  group_by(q52) %>%
  mutate(perc = count / sum(count) * 100) 

# Create a bar plot
ggplot(alcohol_gender, aes(x = q52, y = perc, fill = q14)) +
  geom_bar(stat = "identity", position="dodge") +
  scale_fill_discrete(name = "Do you consume alcohol?") +
  labs(x = "Age", y = "Percentage")+
  theme(axis.text.x = element_text(angle = 20,hjust=1))+
  ggtitle ( "Alcohol consumption by gender")
```

there are more female drinkers(42.11%) than male drinkers(37.42%)


##8 What percentage of the population consumes alcohol, and how does this vary by socioeconomic
```{r}
d8 <- n1[c("q14", "key1")]

# Calculate the percentage of alcoholic by 
alcohol_soc <- d8 %>%
  group_by(q14,key1) %>%
  drop_na() |>
  dplyr::summarize(count = n()) %>%
  group_by(key1) %>%
  mutate(perc = count / sum(count) * 100) 

# Create a bar plot
ggplot(alcohol_soc, aes(x = key1, y = perc, fill = q14)) +
  geom_bar(stat = "identity", position="dodge") +
  scale_fill_discrete(name = "Do you consume alcohol?") +
  labs(x = "Age", y = "Percentage")+
  theme(axis.text.x = element_text(angle = 90,hjust=1))+
  ggtitle ( "Alcohol consumption by socioeconomic status")
```

##9 people from which region drink the most?

```{r}
d9 <- n1[c("q14", "lho","q52")]

# Calculate the percentage of alcoholic by region
alcohol_r <- d9 %>%
  group_by(q14,lho,q52) %>%
  drop_na() |>
  dplyr::summarize(count = n()) %>%
  group_by(lho) %>%
  mutate(perc = count / sum(count) * 100) 

# Create a bar plot
ggplot(alcohol_r, aes(x = lho, y = perc, fill = q14)) +
  geom_bar(stat = "identity", position="dodge") +
  scale_fill_discrete(name = "Do you consume alcohol?") +
  labs(x = "Age", y = "Percentage")+
  theme(axis.text.x = element_text(angle = 90,hjust=1))+
  ggtitle ( "Alcohol consumption by region")
```

people in galway drink the most



##10 health condition
```{r}
d6 <- n1[c("q6", "ageclass", "q52", "spq1")]

# Calculate the percentage of alcoholic by 
h <- d6 %>%
  group_by(ageclass,q6,q52,spq1) %>%
  drop_na() |>
  dplyr::summarize(count = n()) %>%
  mutate(perc = count / sum(count) * 100) 

# Create a bar plot
ggplot(h, aes(x = ageclass, y = perc, fill = spq1)) +
  geom_bar(stat = "identity", position="dodge") +
  scale_fill_discrete(name = "Health condition") +
  labs(x = "Age", y = "Percentage")+
  ggtitle("Health Condition of people who smoke and who doesnt")+
  guides(color = guide_legend(reverse = TRUE))+
  theme(axis.text.x = element_text(angle = 30,hjust=1))+
  facet_grid(vars(q6), vars(q52))
```


It is evident that people who doesnt smoke have a better health.
females from age 25-44 (9.44%), 45-64 (6.93%) and males from age 25-44 (5.96%), 45-64 (4.54%) are the healthy ones who doesnt smoke.



##11 In the last 12 months, how often have you consumed alcoholic beverages and have a smoking habit, and do you have private health insurance?

```{r}
d11 <- n1[c("q6", "q14", "q55", "q52")]

# Calculate the percentage of alcoholic by 
health_ins <- d11 %>%
  group_by(q14,q6,q52,q55) %>%
  drop_na() |>
  dplyr::summarize(count = n()) %>%
  mutate(perc = count / sum(count) * 100) 

# Create a bar plot
ggplot(health_ins, aes(x = q52, y = perc, fill = q55)) +
  geom_bar(stat = "identity", position="dodge") +
  scale_fill_discrete(name = "Do you have private health insurance?") +
  labs(x = "Age", y = "Percentage")+
  ggtitle("Health Insurance for smokers and alcoholics")+
  guides(color = guide_legend(reverse = TRUE))+
  theme(axis.text.x = element_text(angle = 30,hjust=1))+
  facet_grid(vars(q6), vars(q14))
```

this categorizes people who smoke and consume alcohol with whether they own a private health insurance or not. people who drink and doesnt smoke have a private health insurance


##12 How would you describe your current employment status, and are you currently taking a folic acid supplement?

```{r}
d12 <- n1[c("lho","q120")]

# Calculate the percentage by region
suppl <- d12 %>%
  group_by(lho,q120) %>%
  drop_na() |>
  dplyr::summarize(count = n()) %>%
  group_by(lho) %>%
  mutate(perc = count / sum(count) * 100) 

suppl$q120 <- ifelse(suppl$q120 %in% c("No", "Donâ€™t know/refused"), "No", "Yes")

# Create a bar plot
ggplot(suppl, aes(x = lho, y = perc, fill = q120)) +
  geom_bar(stat = "identity", position="dodge") +
  scale_fill_discrete(name = "Do you take folicacid suppliments?") +
  labs(x = "Age", y = "Percentage")+
  theme(axis.text.x = element_text(angle = 90,hjust=1))+
  ggtitle ( "Folic acid consumption by region")
```



#13 Are you the Chief Income Earner in your household, and what is the name or code number of the Local Health Office (LHO) region where you reside?

```{r}
d13 <- n1[c("q6", "q14", "ageclass", "q63b")]

# Calculate the percentage of alcoholic by 
income <- d13 %>%
  group_by(q14,q6,ageclass,q63b) %>%
  drop_na() |>
  dplyr::summarize(count = n()) %>%
  mutate(perc = count / sum(count) * 100) 

# Create a bar plot
ggplot(income, aes(x = ageclass, y = perc, fill = q63b)) +
  geom_bar(stat = "identity", position="dodge") +
  scale_fill_discrete(name = "Chief Income Earner") +
  labs(x = "Age", y = "Percentage")+
  ggtitle("Chief Income Earner")+
  guides(color = guide_legend(reverse = TRUE))+
  theme(axis.text.x = element_text(angle = 30,hjust=1))+
  facet_grid(vars(q6), vars(q14))
```

