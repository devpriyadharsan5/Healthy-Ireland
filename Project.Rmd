---
title: "Exploring the Relationship between Smoking, Alcohol Consumption, and Demographic Factors: A Survey-Based Analysis"

author: "Devpriyadharsan Balan Saravanan - 22250355"

output:
  html_document: default
---

```{r,echo = FALSE, warning=FALSE,message=FALSE}
suppressWarnings(library(haven))
suppressWarnings(library(dplyr))
suppressWarnings(library(magrittr))
suppressWarnings(library(knitr))
suppressWarnings(library(tidyverse))
suppressWarnings(library(ggplot2))
suppressWarnings(library(here))
suppressWarnings(library(dplyr))
suppressWarnings(library(labelled))
suppressWarnings(library(foreign))
suppressWarnings(library(tibble))
suppressWarnings(library(psych)) #masks ggpplot2:: %+%, alpha
suppressWarnings(library(GGally)) #masks dbplyr::nasa
suppressWarnings(library(plyr))
```




```{r}
# Read the data from the SPSS file
data <- read_sav("0021-04_healthy_ireland_2018.sav")
```


```{r}
df1 <- data[c("q6", "q7", "q8", "slq9b", "q10", "q11", "q13", "q340", "q348", "q349")]
# Select columns "q6", "q7", "q8", "slq9b", "q10", "q11", "q13", "q340", "q348", "q349" from the original data frame and assign it to df1.

df2 <- data[c("q14", "exq15", "exq18")]
# Select columns "q14", "exq15", "exq18" from the original data frame and assign it to df2.

df3 <- data[c("spq1", "q52", "q55", "q58", "q120", "q205", "q208", "q308")]
# Select columns "spq1", "q52", "q55", "q58", "q120", "q205", "q208", "q308" from the original data frame and assign it to df3.

df4 <- data[c("q229", "q230", "q231", "q232", "q233", "q330_1", "q330_2", "q330_3")]
# Select columns "q229", "q230", "q231", "q232", "q233", "q330_1", "q330_2", "q330_3" from the original data frame and assign it to df4.

df5 <- data[c("q63b", "lho", "key1", "ageclass", "countbirth")]
# Select columns "q63b", "lho", "key1", "ageclass", "countbirth" from the original data frame and assign it to df5.

```


```{r}
#combines the previously created data frames
newdata <- cbind(df1, df2,df3,df4,df5) 

#write_sav(newdata, "newdata.sav") 
```


```{r}
#val_labels(df2) #gives options
```


```{r}
#var_label(df2) #gives questions
```



```{r}
#converting to factors

n1<- to_factor((newdata), drop_unused_labels=TRUE, ordered=TRUE) #always use n1

#table(n1$q6,exclude = NULL)
```


###  1. What percentage of the population smokes and how does this vary by age?

```{r, echo = FALSE, warning=FALSE,message=FALSE}

s1 <- n1 %>% 
  dplyr::group_by(q6, ageclass) %>%  # Group the data by smoking status (q6) and age group (ageclass)
  dplyr::summarise(count = n()) |>
  drop_na() |>
  ungroup() %>%
  group_by(ageclass) %>%
  dplyr::mutate(perc = count/sum(count)*100) %>%  # Calculate the percentage within each age group
  dplyr::select(ageclass, q6, count)  # Select only the relevant columns for further analysis


# Re-code smoking variable to combine "Yes, daily" and "Yes, occasionally"
s1$q6 <- ifelse(s1$q6 %in% c("Yes, daily", "Yes, occasionally"), "Yes", "No")


# Calculate the percentage of individuals in each group ## Code modified by NC
smoking_by_age <- 
  s1 %>% 
  group_by(ageclass, q6) %>%  # Group the data by age group and smoking status
  dplyr::summarise(count = sum(count)) %>%  # Summarize the count of observations within each group
  ungroup() %>% 
  group_by(ageclass) %>%  # Group the data only by age group
  dplyr::summarise(perc = count*100/sum(count),  # Calculate the percentage within each age group
                   q6 = q6) %>%  # Keep the smoking status variable for plotting purposes
  arrange(ageclass)  # Arrange the data by age group in ascending order


# Plot the results
ggplot(smoking_by_age, aes(x = ageclass, y = perc, fill = q6)) +
  geom_bar(stat = "identity")+
  labs(x = "Age", y = "Percentage of population", fill = "Smoking status") +
  scale_fill_discrete(name = "Do you Smoke?") +
  ggtitle("Smoking by Age") +
  theme(plot.title = element_text(hjust = 0.5))

```

This output provides insights into the prevalence of smoking among different age groups. 

* For the age group **15-24 years**, the percentage of non-smokers is approximately 80.06% and the percentage of smokers is 19.94%.

* For the age group **25-44 years**, the percentage of non-smokers is approximately 76.17% and the percentage of smokers is 23.83%.

* For the age group **45-64 years**, the percentage of non-smokers is approximately 80.58% and the percentage of smokers is 19.42%.

* For the age group **65 and over**, the percentage of non-smokers is approximately 89.44% and the percentage of smokers is 10.56%.


The highest percentage of smokers is observed in the age group "25-44 years" with approximately 23.83% of individuals being smokers. This age group has a higher smoking prevalence compared to other age groups.

The age group "65 and over" has the lowest smoking prevalence, with only approximately 10.56% of individuals being smokers. This age group has the lowest percentage of smokers among all the age groups analyzed.

The age groups "15-24 years" and "45-64 years" show relatively similar smoking prevalence, with approximately 19.94% and 19.42% of individuals being smokers, respectively.


Overall, the analysis indicates that smoking prevalence varies across different age groups. These findings highlight the importance of targeted smoking prevention and cessation efforts, particularly among the younger age groups where smoking rates are relatively higher.



**Calculating relative risk and an odds ratio for 25-44 year olds compared to 65 +**

* relative risk = 0.2383/0.1056 = 2.25

* odds for 25-44 = 0.2383/(1-0.2383) = 0.31

* odds for 65+ = 0.1056/(1-0.1056) = 0.12

* odds ratio = 0.31/0.12 = 2.58


The relative risk compares the risk of smoking between the two age groups. A relative risk of 2.25 means that individuals in the 25-44 age group have a 2.25 times higher risk of smoking compared to individuals aged 65 and above. This indicates that the younger age group has a significantly higher likelihood of being smokers compared to the older age group.


The odds ratio compares the odds of smoking between the two age groups. An odds ratio of 2.58 means that the odds of smoking in the 25-44 age group are 2.58 times higher than the odds of smoking in the 65+ age group. This suggests that individuals in the younger age group are more likely to smoke than individuals in the older age group.



This finding highlights the importance of targeted interventions and prevention efforts to reduce smoking prevalence among younger individuals. It suggests that specific strategies and policies should be implemented to address the higher smoking rates observed in the 25-44 age group. These measures could include education, awareness campaigns, smoking cessation programs, and policies aimed at reducing tobacco accessibility and promoting healthier behaviors.





#### Chi-squared test
```{r,echo = FALSE, warning=FALSE,message=FALSE}
q1 <- n1 %>%
  dplyr::select(q6, ageclass) |>  # Select the variables of interest
  table()  # Create a contingency table

chisq.test(q1)  # Perform the chi-squared test


```





### 2. What percentage of the population smokes and how does this vary by gender?

```{r, echo = FALSE, warning=FALSE,message=FALSE}

s2 <- n1 %>%
  dplyr::group_by(q6, q52) %>%
  dplyr::summarise(count = n()) |>  # Count the number of individuals in each smoking status and gender combination
  drop_na() |>  # Drop rows with missing values
  ungroup() %>%
  group_by(q52) %>%
  dplyr::mutate(perc = count/sum(count)*100) |>  # Calculate the percentage of individuals in each group
  dplyr::select(q52, q6, count)  # Select relevant columns


# Recode smoking variable to combine "Yes, daily" and "Yes, occasionally"
s2$q6 <- ifelse(s2$q6 %in% c("Yes, daily", "Yes, occasionally"), "Yes", "No")


# Calculate the percentage of smokers by gender
smoking_by_gender <- 
  s2 %>%
  group_by(q52, q6) %>%
  dplyr::summarise(count = sum(count)) %>%
  ungroup() %>%
  group_by(q52) %>%
  dplyr::summarise(perc = count*100/sum(count),
                   q6 = q6) %>%
  arrange(q52)

# Plot the results
ggplot(smoking_by_gender, aes(x = q52, y = perc, fill = q6)) +
  geom_bar(stat = "identity") +
  labs(x = "Gender", y = "Percentage", fill = "Smoking") +
  ggtitle("Percentage of population that smokes, by gender")

```



The output provides a clear breakdown of the percentage of population that smokes, categorized by gender.

1. For males, 21.19% of them reported smoking, while the majority (78.81%) do not smoke. On the other hand, among females, only 16.38% reported smoking, while the majority (83.62%) do not smoke.

2. This indicates that both males and females have a higher percentage of non-smokers compared to smokers. However, there is a slightly higher prevalence of smoking among males compared to females.

This information can be useful for public health interventions and targeted smoking cessation programs, taking into account the gender-specific patterns of smoking behavior.


**calculating relative risk and an odds ratio for males compared to females**

* relative risk = 0.2119/0.1637 = 1.29

* odds for males = 0.2119/(1-0.2119) = 0.26  yes/no

* odds for females = 0.1637/(1-0.1637) = 0.19

* odds ratio = 0.31/0.12 = 1.36


The relative risk compares the risk of smoking between males and females. A relative risk of 1.29 means that males have a 1.29 times higher risk of smoking compared to females. This suggests that males are slightly more likely to be smokers than females.

The odds ratio compares the odds of smoking between males and females. An odds ratio of 1.36 means that the odds of smoking in males are 1.36 times higher than the odds of smoking in females. This indicates that males have slightly higher odds of being smokers compared to females.

It's important to note that while the relative risk and odds ratio indicate a small difference in smoking prevalence between males and females, the effect size is relatively modest. Other factors such as socio-cultural influences, socioeconomic status, and individual behaviors can also play a significant role in smoking patterns.

Efforts to reduce smoking rates should consider the gender-specific factors that contribute to smoking behavior. Tailored interventions and targeted strategies may be beneficial to address the higher smoking rates observed among males. These may include gender-specific smoking cessation programs, awareness campaigns, and policy measures to reduce smoking prevalence and promote healthier lifestyles for all genders.



#### Chi-squared test
```{r,echo = FALSE, warning=FALSE,message=FALSE}
q2<- n1 |> dplyr::select(q6,q52)|> # Select the variables of interest
  table() # Create a contingency table

chisq.test(q2) # Perform the chi-squared test
```



### 3. What percentage of the population smokes and how does this vary by socioeconomic status?
```{r, echo = FALSE, warning=FALSE,message=FALSE}

n1$q6 <- ifelse(n1$q6 %in% c("Yes, daily", "Yes, occasionally"), "Yes", "No")  # Recode the smoking variable to combine "Yes, daily" and "Yes, occasionally" into "Yes"

s3 <- n1 %>%
  dplyr::group_by(q6, key1) %>%
  dplyr::summarise(count = n()) |>
  drop_na() |>
  ungroup() %>%
  group_by(key1) %>%
  dplyr::mutate(perc = count/sum(count)*100) %>%
  dplyr::select(key1, q6, count)  # Create a summary table with counts and percentages of smokers by socioeconomic status (key1)

smoking_by_ses <- 
  s3 %>% 
  group_by(key1, q6) %>% 
  dplyr::summarise(count = sum(count)) %>% 
  ungroup() %>% 
  group_by(key1) %>% 
  dplyr::summarise(perc = count*100/sum(count),
                   q6 = q6) %>% 
  arrange(key1)  # Calculate the percentage of smokers within each socioeconomic status category

# Plot the results
ggplot(smoking_by_ses, aes(x = key1, y = perc, fill = q6)) +
  geom_bar(stat = "identity") +
  scale_fill_discrete(name = "Do You Smoke?") +
  labs(x = "Socioeconomic Status", y = "Percentage of Smokers") +
  theme(axis.text.x = element_text(angle = 90)) +
  scale_x_discrete(labels = function(x) stringr::str_wrap(x, width = 15)) +
  ggtitle("Smoking Rates by Socioeconomic Status")


```


The data reveals interesting patterns in smoking rates across different socioeconomic groups. 

1. Smoking Rates: The data reveals varying smoking rates among different socioeconomic groups. For example, the "A Employers and Managers" group has a smoking rate of 13.01%, while the "B Higher Professional" group has a smoking rate of 7.95%. On the other hand, the "G Unskilled" group has a higher smoking rate of 29.91%. These differences indicate that smoking behavior differs across socioeconomic categories.

2. Socioeconomic Disparities: The data highlights notable disparities in smoking rates across socioeconomic groups. Some groups, such as "A Employers and Managers" and "B Higher Professional," have relatively lower smoking rates, while groups like "G Unskilled" have higher smoking rates. These disparities suggest that socioeconomic factors play a role in smoking behavior.

3. Socioeconomic Influence: The data supports the hypothesis that socioeconomic status influences smoking rates. Higher socioeconomic groups tend to have lower smoking rates, potentially due to factors like better access to healthcare, higher awareness of health risks, and stronger social norms against smoking. In contrast, lower socioeconomic groups face more challenges in quitting smoking, such as limited resources for smoking cessation programs and higher exposure to smoking triggers.


In conclusion, the analysis of the data underscores the association between smoking rates and socioeconomic status. The findings indicate that smoking rates significantly vary across different socioeconomic groups, suggesting a link between socioeconomic factors and smoking behavior. These findings highlight the importance of considering socioeconomic disparities when implementing smoking cessation programs, tobacco control policies, and public health campaigns. 


Targeted interventions should focus on addressing the specific needs and challenges faced by different socioeconomic groups. Efforts should be made to provide accessible and affordable smoking cessation resources, education on the health risks of smoking, and supportive environments to help individuals quit smoking, particularly in higher-risk groups with higher smoking rates.

By understanding the relationship between smoking and socioeconomic status, policymakers, healthcare professionals, and public health advocates can develop comprehensive strategies to reduce smoking prevalence, promote healthier behaviors, and improve overall population health.



**calculating relative risk and an odds ratio for Unskilled compared to Employers and Managers**

* relative risk = 0.2991/0.1301 = 2.99


* odds for Unskilled = 0.2991/(1-0.2991) = 0.43

* odds for Employers and Managers = 0.1301/(1-0.1301) = 0.15  

* odds ratio = 0.43/0.15 = 2.87


The relative risk compares the risk of smoking between Unskilled workers and Employers/Managers. A relative risk of 2.99 means that Unskilled workers have a 2.99 times higher risk of smoking compared to Employers/Managers. This suggests that Unskilled workers are almost three times more likely to be smokers compared to Employers/Managers.

The odds ratio compares the odds of smoking between Unskilled workers and Employers/Managers. An odds ratio of 2.87 means that the odds of smoking in Unskilled workers are 2.87 times higher than the odds of smoking in Employers/Managers. This indicates that Unskilled workers have significantly higher odds of being smokers compared to Employers/Managers.

These findings highlight the importance of considering occupational factors when developing tobacco control and smoking cessation strategies. Unskilled workers may face unique challenges and higher levels of stress, which can contribute to higher smoking rates. Tailored interventions, workplace-based smoking cessation programs, and policies promoting smoke-free environments may be beneficial for reducing smoking prevalence among Unskilled workers.

It is important to address health disparities and provide support and resources for individuals in different occupational categories. By understanding the specific needs and challenges faced by Unskilled workers, targeted interventions can be developed to help reduce smoking rates and improve overall health outcomes.




#### Chi-squared test
```{r,echo = FALSE, warning=FALSE,message=FALSE}
q3<- n1 |> dplyr::select(q6,key1)|> # Select the variables of interest
  table() # Create a contingency table

chisq.test(q3) # Perform the chi-squared test
```



### 4. What are the observed variations in smoking rates across different local health offices (LHOs) in various counties?
```{r, echo = FALSE, warning=FALSE,message=FALSE}

s4 <- n1 %>%
  dplyr::group_by(q6, lho) %>%
  dplyr::summarise(count = n()) |>
  drop_na() |>
  ungroup() %>%
  group_by(lho) %>%
  dplyr::mutate(perc = count/sum(count)*100) %>%
  dplyr::select(lho, q6, count)  # Create a summary table with counts and percentages of smokers by region (lho)

smoking_by_region <- 
  s4 %>% 
  group_by(lho, q6) %>% 
  dplyr::summarise(count = sum(count)) %>% 
  ungroup() %>% 
  group_by(lho) %>% 
  dplyr::summarise(perc = count*100/sum(count),
                   q6 = q6) %>% 
  arrange(lho)  # Calculate the percentage of smokers within each region

# Plot the results
ggplot(smoking_by_region, aes(x = lho, y = perc, fill = q6)) +
  geom_bar(stat = "identity") +
  scale_fill_discrete(name = "Do You Smoke?") +
  labs(x = "County", y = "Percentage") +
  theme(axis.text.x = element_text(angle = 90)) +
  ggtitle("Smoking Rates in Various Regions")

```



The provided table displays the smoking rates in different local health offices (LHOs) across various counties. It includes the LHO names (lho), the percentage of smokers or non-smokers (perc), and the smoking status (q6: "Yes" indicates smokers, "No" indicates non-smokers).


1. Smoking Rates by LHO: The table presents the smoking rates within each LHO. For example, in Carlow/Kilkenny, 17.32% of the population are smokers, while in Cavan/Monaghan, the smoking rate is 17.82%. These rates differ across LHOs, indicating variations in smoking behaviors between different areas.

2. Variation in Smoking Rates: The data highlights significant differences in smoking rates across LHOs. For instance, Dun Laoghaire exhibits a low smoking rate of 6.15%, while Dublin South East has a relatively higher rate of 88.29%. These disparities emphasize the importance of considering regional factors and implementing targeted smoking cessation programs.

3. Regional Comparison: The table allows for a comparison of smoking rates among different counties. For example, some counties like Kerry and Meath have relatively balanced smoking rates, with percentages close to 50% for smokers and non-smokers. In contrast, Dun Laoghaire stands out with a significantly lower smoking rate compared to other counties.

Understanding these variations can aid in developing targeted interventions and public health campaigns to reduce smoking prevalence in specific regions.


**calculating relative risk and an odds ratio for Roscommon compared to Dun Laoghaire**

* relative risk = 0.2488/0.0615 = 4.04


* odds for Roscommon = 0.2488/(1-0.2488) = 0.33

* odds for Dun Laoghaire = 0.0615/(1-0.0615) = 0.06  

* odds ratio = 0.43/0.15 = 5.5



The relative risk compares the risk of smoking between Roscommon and Dun Laoghaire. A relative risk of 4.04 means that individuals from Roscommon have a 4.04 times higher risk of smoking compared to individuals from Dun Laoghaire. This suggests that smoking prevalence is significantly higher in Roscommon compared to Dun Laoghaire.

The odds ratio compares the odds of smoking between Roscommon and Dun Laoghaire. An odds ratio of 5.5 means that the odds of smoking in Roscommon are 5.5 times higher than the odds of smoking in Dun Laoghaire. This indicates that individuals from Roscommon have significantly higher odds of being smokers compared to individuals from Dun Laoghaire.


These findings highlight regional disparities in smoking prevalence and suggest that there may be regional-specific factors influencing smoking behavior. Understanding the underlying determinants of higher smoking rates in Roscommon can help inform targeted interventions and policies to reduce smoking prevalence in that region. Such interventions may include community-based smoking cessation programs, increased access to tobacco cessation resources, and targeted public health campaigns.

It is important to address these regional disparities in smoking rates to promote equitable health outcomes and reduce the burden of smoking-related diseases. By identifying and targeting the unique challenges and risk factors in regions with higher smoking prevalence, effective strategies can be implemented to reduce smoking rates and improve the overall health of the population.




#### Chi-squared test
```{r,echo = FALSE, warning=FALSE,message=FALSE} 
q4<- n1 |> dplyr::select(q6,lho)|> # Select the variables of interest
  table() # Create a contingency table

chisq.test(q4) # Perform the chi-squared test
```




### 5. How do smoking rates vary based on the country of birth?

```{r, echo = FALSE, warning=FALSE,message=FALSE}

s5 <- n1 %>% 
  dplyr::group_by(q6, countbirth) %>% 
  dplyr::summarise(count = n()) |>
  drop_na() |>
  ungroup() %>%
  group_by(countbirth) %>%
  dplyr::mutate(perc = count/sum(count)*100) %>%
  dplyr::select(countbirth, q6, count)


smoking_by_country <- 
  s5 %>% 
  group_by(countbirth, q6) %>% 
  dplyr::summarise(count = sum(count)) %>% 
  ungroup() %>% 
  group_by(countbirth) %>% 
  dplyr::summarise(perc = count*100/sum(count),
                   q6 = q6) %>% 
  arrange(countbirth)


# Plot the results
ggplot(smoking_by_country, aes(x = countbirth, y = perc, fill = q6)) +
  geom_bar(stat = "identity") +
  scale_fill_discrete(name = "Do you Smoke?") +
  labs(x = "County", y = "Percentage")+
  theme(axis.text.x = element_text(angle = 30,hjust=1))+
  ggtitle ("Country-wise Distribution of Smoking Rates")

```

The graph displays the smoking rates based on the country of birth. 

1. Smoking Rates by Country of Birth: The table presents the smoking rates among individuals based on their country of birth. For example, among individuals born in Ireland, 17.66% are smokers, while among those born in the UK, the smoking rate is 22.25%. These rates differ based on the country of birth, indicating variations in smoking behaviors among different populations.

2. Variation in Smoking Rates: The data highlights significant differences in smoking rates based on the country of birth. For instance, individuals born in the Rest of the World have a lower smoking rate of 11.05%, while those born in the Rest of EU have a higher rate of 34.46%. These disparities suggest that cultural and demographic factors associated with the country of birth may influence smoking behaviors.

3. Comparison by Country of Birth: The table allows for a comparison of smoking rates among individuals from different countries. For example, individuals born in Ireland have a relatively balanced smoking rate, with 17.66% being smokers. In contrast, individuals born in the Rest of the World exhibit a significantly lower smoking rate of 11.05%.

Understanding these variations can help in developing targeted interventions and tailored smoking cessation programs for specific populations. It emphasizes the importance of considering cultural and demographic factors associated with the country of birth when addressing smoking behaviors.



**calculating relative risk and an odds ratio for Ireland compared to Rest of EU**

* relative risk = 0.1765/0.3446 = 0.51


* odds for Ireland = 0.1765/(1-0.1765) = 0.21

* odds for Rest of EU = 0.3446/(1-0.3446) = 0.52 

* odds ratio = 0.43/0.15 = 0.41


The relative risk compares the risk of smoking between Ireland and the Rest of the EU. A relative risk of 0.51 suggests that individuals in Ireland have a 0.51 times lower risk of smoking compared to individuals in the Rest of the EU. This indicates that smoking prevalence is lower in Ireland compared to the Rest of the EU.

The odds ratio compares the odds of smoking between Ireland and the Rest of the EU. An odds ratio of 0.41 means that the odds of smoking in Ireland are 0.41 times lower than the odds of smoking in the Rest of the EU. This further supports the finding that individuals in Ireland have lower odds of being smokers compared to individuals in the Rest of the EU.


These findings reflect the effectiveness of tobacco control measures and public health campaigns in Ireland, which have contributed to a lower prevalence of smoking. The implementation of comprehensive tobacco control policies, including smoking bans, increased taxation on tobacco products, and public health education, has played a crucial role in reducing smoking rates in Ireland.

Continued efforts and investments in comprehensive tobacco control strategies are necessary to maintain and further reduce smoking rates, not only in Ireland but also in the Rest of the EU. By prioritizing evidence-based interventions and adopting best practices, public health authorities can contribute to improving population health and reducing the burden of smoking-related diseases.



### 6. What is the distribution of health conditions among smokers and non-smokers across different age classes and genders?

```{r, echo = FALSE, warning=FALSE,message=FALSE}

# converting the values "Fair", "Bad", and "Very Bad" to "Bad" and keeps the rest of the values as "Good" or "Very Good"

n1$spq1 <- ifelse(n1$spq1 %in% c("Fair", "Bad", "Very Bad"), "Bad", ifelse(n1$spq1 == "Good", "Good", "Very Good"))

s6 <- n1[c("q6", "ageclass", "q52", "spq1")]

# Calculate the percentage of smoking by 
h <- s6 %>%
  group_by(ageclass,q6,q52,spq1) %>%
  drop_na() |>
  dplyr::summarize(count = n()) %>%
  ungroup() %>%
  group_by(q6,q52,ageclass) %>%
  dplyr::mutate(perc = count*100/sum(count)) 


# Plot the results
ggplot(h, aes(x = ageclass, y = perc, fill = spq1)) +
  geom_bar(stat = "identity") +
  scale_fill_discrete(name = "Health condition") +
  labs(x = "Age", y = "Percentage")+
  ggtitle("Health Condition of people who smoke and who doesnt")+
  guides(color = guide_legend(reverse = TRUE))+
  theme(axis.text.x = element_text(angle = 30,hjust=1))+
  facet_grid(~(q6)+~(q52),labeller = label_both)

```



The provided data shows the distribution of individuals across different age groups (ageclass) and their smoking status (q6). The data also includes information about gender (GENDER), self-reported health status (spq1), and percentage of individuals in each category.


1. **Age Group: 15-24 years:**

   a) **Male:**
   
   * Non-smokers: 66.27% of non-smoking males reported very good health conditions.
   
   * Smokers: Among male smokers, 47.14% reported very good health conditions. This suggests that a significant proportion of male smokers still maintain good overall health.


   b) **Female:**
   
   * Non-smokers: 69.14% of non-smoking females reported very good health conditions.
   
   * Smokers: Among female smokers, 55.56% reported very good health conditions. This indicates that a considerable proportion of female smokers still enjoy good overall health.


2. **Age Group: 25-44 years:**

   a) **Male:**
   
   * Non-smokers: 62.03% of non-smoking males reported very good health conditions.
   
   * Smokers: Among male smokers, 55.89% reported very good health conditions. This suggests that a considerable proportion of male smokers still maintain good overall health.
   

   b) **Female:**
   
   * Non-smokers: 62.08% of non-smoking females reported very good health conditions.
   
   * Smokers: Among female smokers, 48.17% reported very good health conditions. This indicates that a significant proportion of female smokers still enjoy good overall health.


3. **Age Group: 45-64 years:**

   a) **Male:**
   
   * Non-smokers: 40.51% of non-smoking males reported very good health conditions.
   
   * Smokers: Among male smokers, 45.27% reported good health conditions. This suggests that a significant proportion of male smokers still maintain relatively good overall health.


   b) **Female:**
   
   * Non-smokers: 46.31% of non-smoking females reported very good health conditions.
   
   * Smokers: Among female smokers, 44.86% reported good health conditions. This indicates that a considerable proportion of female smokers still enjoy relatively good overall health.


4. **Age Group: 65 and over:**

   a) **Male:**
   
   * Non-smokers: 30.84% of non-smoking males reported bad health conditions.
   
   * Smokers: Among male smokers, 43.70% reported good health conditions. This suggests that a considerable proportion of male smokers still maintain relatively good overall health.


   b) **Female:**
   
   * Non-smokers: 28.76% of non-smoking females reported bad health conditions.
   
   * Smokers: Among female smokers, 47.47% reported good health conditions. This indicates that a significant proportion of female smokers still enjoys relatively good overall health.


   **Conclusion:** 
   
* In the 15-24 age group, both male and female non-smokers generally maintain very good health. Among smokers, a significant proportion still maintains good overall health, although the percentage is slightly lower than non-smokers.


* In the 25-44 age group, both male and female non-smokers generally maintain very good health. Among smokers, a considerable proportion still maintains good overall health, although the percentage is lower than non-smokers.
   
   
* In the 45-64 age group, both male and female non-smokers generally maintain good overall health. Among smokers, a significant proportion still maintains relatively good health conditions.

   
* In the 65 and over age group, both non-smoking males and females exhibit a higher prevalence of health issues. However, among smokers, a considerable proportion still maintains relatively good health conditions.
   
   
   
Overall, the analysis shows that while smoking can have negative health effects, a significant proportion of individuals across different age groups and genders still maintain good or very good health despite being smokers. It's important to note that quitting smoking is generally associated with better health outcomes. These findings highlight the need for smoking cessation efforts and personalized health considerations when assessing the relationship between smoking and health outcomes.



### 7. In the last 12 months, how often you have a smoking habit, and do you have private health insurance?


```{r, echo = FALSE, warning=FALSE,message=FALSE}
s7 <- n1[c("q6", "q52", "ageclass", "q55")]

# Calculate the percentage of alcoholic by 
health_ins_smoke <- s7 %>%
  group_by(q6,q52,ageclass,q55) %>%
  drop_na() |>
  dplyr::summarize(count = n()) %>%
  ungroup() %>%
  group_by(q6,q52,ageclass) %>%
  dplyr::mutate(perc = count*100/sum(count)) 

# Plot the results
ggplot(health_ins_smoke, aes(x = ageclass, y = perc, fill=q55)) +
  geom_bar(stat = "identity") +
  scale_fill_discrete(name = "Do you have private health insurance?") +
  labs(x = "Age", y = "Percentage")+
  ggtitle("Percentage of Individuals with Private Health Insurance by \nSmoking Status, Gender, and Age Group")+
  guides(color=guide_legend(nrow=2, byrow=TRUE,reverse = TRUE))+
  theme(axis.text.x = element_text(angle = 90,vjust=0,hjust=1),plot.title = element_text(lineheight = 1.1))+
  facet_grid(~(q6)+~(q52),labeller = label_both)

```


Let's analyze the relationship between smoking status, gender, age group, and the possession of private health insurance:

1. **Smoking Status: No**

   a) **Male:**
   
   * Age Group: 15-24 years: Among non-smoking males, 56.86% do not have private health insurance, while 43.14% have private health insurance.
   
   * Age Group: 25-44 years: Among non-smoking males, 51.62% do not have private health insurance, while 48.38% have private health insurance.
   
   * Age Group: 45-64 years: Among non-smoking males, 44.44% do not have private health insurance, while 55.56% have private health insurance.
   
   * Age Group: 65 and over: Among non-smoking males, 52.10% do not have private health insurance, while 47.90% have private health insurance.
   

   b) **Female:**
   
   * Age Group: 15-24 years: Among non-smoking females, 58.02% do not have private health insurance, while 41.98% have private health insurance.
   
   * Age Group: 25-44 years: Among non-smoking females, 50.81% do not have private health insurance, while 49.19% have private health insurance.
   
   * Age Group: 45-64 years: Among non-smoking females, 41.63% do not have private health insurance, while 58.37% have private health insurance.
   
   * Age Group: 65 and over: Among non-smoking females, 48.13% do not have private health insurance, while 51.87% have private health insurance.


2. **Smoking Status: Yes**

   a) **Male:**
   
   * Age Group: 15-24 years: Among smoking males, 75.71% do not have private health insurance, while 24.29% have private health insurance.
   
   * Age Group: 25-44 years: Among smoking males, 76.77% do not have private health insurance, while 23.23% have private health insurance.
   
   * Age Group: 45-64 years: Among smoking males, 75.31% do not have private health insurance, while 24.69% have private health insurance.
   
   * Age Group: 65 and over: Among smoking males, 77.31% do not have private health insurance, while 22.69% have private health insurance.
   

   b) **Female:**
   
   * Age Group: 15-24 years: Among smoking females, 81.48% do not have private health insurance, while 18.52% have private health insurance.
   
   * Age Group: 25-44 years: Among smoking females, 83.39% do not have private health insurance, while 16.61% have private health insurance.
   
   * Age Group: 45-64 years: Among smoking females, 72.02% do not have private health insurance, while 27.98% have private health insurance.
   
   * Age Group: 65 and over: Among smoking females, 70.71% do not have private health insurance, while 29.29% have private health insurance.


**Conclusion:**

  * Private health insurance appears to have a somewhat mitigating effect on smoking rates, particularly among females. Females with private health insurance generally have lower smoking rates compared to females without private health insurance in most age groups.


  * Among males, the influence of private health insurance on smoking rates is not as pronounced, with some age groups showing slightly higher smoking rates among those with private health insurance.
    
  * The highest smoking rates are observed among individuals without private health insurance, particularly among females aged 45-64 years and males aged 45-64 years and 65 and over.

  * These findings highlight the importance of promoting smoking cessation programs, public health campaigns, and access to affordable healthcare, including private health insurance, to address and reduce smoking rates, especially among vulnerable populations.



### 8. What is the relationship between the prevalence of smoking among the surveyed individuals based on their age group and their status as the Chief Income Earner in their household?


```{r, echo = FALSE, warning=FALSE,message=FALSE}
s8 <- n1[c("q6", "ageclass", "q63b")]

income <- s8 %>%
  group_by(ageclass,q63b,q6) %>%
  drop_na() |>
  dplyr::summarize(count = n()) %>%
  ungroup() %>%
  group_by(ageclass,q63b) %>%
  dplyr::mutate(perc = count*100/sum(count),q6=q6) 


ggplot(income, aes(x = ageclass, y = perc, fill=q6)) +
  geom_bar(stat = "identity") +
  scale_fill_discrete(name = "Do You Smoke") +
  labs(x = "Age", y = "Percentage")+
  ggtitle("Chief Income Earner")+
  guides(color = guide_legend(reverse = TRUE))+
  theme(axis.text.x = element_text(angle = 30,hjust=1))+
  facet_wrap(~q63b,labeller = label_both)

```



Based on the breakdown of being the Chief Income Earner in the household (q63b) by age class (AGECLASS) and smoking status (q6):

1. **Age Class: 15-24 years**:

   * Among individuals aged 15-24 years, the majority (85.98%) are not the Chief Income Earner in their household, regardless of their smoking status.
  
   * Among those who are not the Chief Income Earner, the count is 417, representing a significant proportion of this age group.
  
   * Among those who are the Chief Income Earner, the count is 137, with a higher percentage (40.88%) for non-smokers compared to smokers (14.02%).


2. **Age Class: 25-44 years**:

   * In the age group of 25-44 years, a majority of individuals (81.70%) who are not the Chief Income Earner, regardless of their smoking status.
   
   * The count for individuals not holding the role of Chief Income Earner is 634, indicating a significant portion of this age group.
   
   * Among those who are the Chief Income Earner, the count is 456, with a higher percentage (73.69%) for non-smokers compared to smokers (26.31%).


3. **Age Class: 45-64 years**:
  
   * Among individuals aged 45-64 years, the majority (85.63%) who are not the Chief Income Earner in their household, regardless of their smoking status.
  
   * The count for individuals not holding the role of Chief Income Earner is 572, representing a significant proportion of this age group.
  
   * Among those who are the Chief Income Earner, the count is 390, with a higher percentage (78.75%) for non-smokers compared to smokers (21.25%).


4. **Age Class: 65 and over**:

   * In the age group of 65 and over, the majority (93.38%) who are not the Chief Income Earner in their household, regardless of their smoking status.
  
   * The count for individuals not holding the role of Chief Income Earner is 282, indicating a significant portion of this age group.
  
   * Among those who are the Chief Income Earner, the count is 198, with a higher percentage (88.77%) for non-smokers compared to smokers (11.23%).


Overall, the data indicates that across all age classes, a larger percentage of individuals are not the Chief Income Earner in their household, irrespective of their smoking status. However, among those who hold the role of Chief Income Earner, there is a higher percentage of non-smokers compared to smokers in each age group.

It's important to note that being the Chief Income Earner can depend on various factors such as education, occupation, and household dynamics. Further analysis and consideration of these factors would be necessary to draw more definitive conclusions.




### 9. What percentage of the population consumes alcohol and how does this vary by age?

```{r, echo = FALSE, warning=FALSE,message=FALSE}
n1$q14 <- ifelse(n1$q14 %in% c("Yes", "Have only had a few sips of alcohol in my lifetime"), "Yes", "No")

s9 <- n1 %>% 
  dplyr::group_by(q14, ageclass) %>% 
  dplyr::summarise(count = n()) |>
  drop_na() |>
  ungroup() %>%
  group_by(ageclass) %>%
  dplyr::mutate(perc = count/sum(count)*100) %>%
  dplyr::select(ageclass, q14, count)


drinking_by_age <- 
  s9 %>% 
  group_by(ageclass, q14) %>% 
  dplyr::summarise(count = sum(count)) %>% 
  ungroup() %>% 
  group_by(ageclass) %>% 
  dplyr::summarise(perc = count*100/sum(count),
                   q14 = q14) %>% 
  arrange(ageclass)

# Plot the results
ggplot(drinking_by_age, aes(x = ageclass, y = perc, fill = q14)) +
  geom_bar(stat = "identity") +
  scale_fill_discrete(name = "Do you consume alcohol?") +
  labs(x = "Age", y = "Percentage")+
  ggtitle ( "Alcohol consumption by age")

```


1. **Age Group "15-24 years"**: The majority of individuals in this age group (77.33%) consume alcohol, while a smaller percentage (22.67%) do not consume alcohol.

2. **Age Group "25-44 years"**: A significant majority of individuals in this age group (91.07%) consume alcohol, with only a small percentage (8.93%) not consuming alcohol.

3. **Age Group "45-64 years"**: A high percentage of individuals in this age group (87.50%) consume alcohol, while a relatively smaller percentage (12.50%) do not consume alcohol.

4. **Age Group "65 and over"**: The majority of individuals in this age group (80.48%) consume alcohol, while a smaller percentage (19.52%) do not consume alcohol.

Overall, the data suggests that alcohol consumption tends to be more prevalent among younger age groups (15-24 years and 25-44 years) compared to older age groups (45-64 years and 65 and over).



**calculating relative risk and an odds ratio (Alcohol consumption) for 25-44 year olds compared to 65 +**

* relative risk = 0.9107/0.8048 = 1.13

* odds for 25-44 = 0.9107/(1-0.9107) = 10.19

* odds for 65+ = 0.8048/(1-0.8048) = 4.12

* odds ratio = 0.31/0.12 = 2.47


The relative risk of 1.13 indicates that individuals in the 25-44 age group have a 1.13 times higher risk of consuming alcohol compared to those in the 65 and over age group. This suggests a slightly higher prevalence of alcohol consumption in the younger age group.

The odds ratio of 2.47 implies that the odds of alcohol consumption are 2.47 times higher in the 25-44 age group compared to the 65 and over age group. This indicates a significant difference in alcohol consumption patterns between the two age groups, with a higher likelihood of alcohol consumption in the younger age group.


These findings align with general trends in alcohol consumption, where younger individuals tend to have higher rates of alcohol use. It is important to address alcohol consumption behaviors, particularly among younger age groups, through education, awareness campaigns, and targeted interventions to promote responsible and healthy alcohol consumption habits. Additionally, efforts to prevent alcohol-related harm should also be focused on older age groups, as a significant proportion of individuals in these age groups still consume alcohol.


#### Chi-squared test
```{r,echo = FALSE, warning=FALSE,message=FALSE}
q5 <- n1 %>%
  dplyr::select(q14, ageclass) |>  # Select the variables of interest
  table()  # Create a contingency table

chisq.test(q5)  # Perform the chi-squared test


```




### 10. What percentage of the population consumes alcohol and how does this vary by gender?
```{r, echo = FALSE, warning=FALSE,message=FALSE}

s10 <- n1 %>% 
  dplyr::group_by(q14, q52) %>% 
  dplyr::summarise(count = n()) |>
  drop_na() |>
  ungroup() %>%
  group_by(q52) %>%
  dplyr::mutate(perc = count/sum(count)*100) %>%
  dplyr::select(q52, q14, count)


drinking_by_gender <- 
  s10 %>% 
  group_by(q52, q14) %>% 
  dplyr::summarise(count = sum(count)) %>% 
  ungroup() %>% 
  group_by(q52) %>% 
  dplyr::summarise(perc = count*100/sum(count),
                   q14 = q14) %>% 
  arrange(q52)

# Plot the results
ggplot(drinking_by_gender, aes(x = q52, y = perc, fill = q14)) +
  geom_bar(stat = "identity") +
  scale_fill_discrete(name = "Do you consume alcohol?") +
  labs(x = "Age", y = "Percentage")+
  theme(axis.text.x = element_text(hjust=1))+
  ggtitle ( "Alcohol consumption by gender")
```

Males: Among males, a significant majority (88.88%) consume alcohol, while a relatively smaller percentage (11.12%) do not consume alcohol.

Females: Among females, the majority (83.60%) consume alcohol, while a smaller percentage (16.40%) do not consume alcohol.

Based on the provided data, it appears that both males and females have a substantial proportion of individuals who consume alcohol. 


**calculating relative risk and an odds ratio (Alcohol consumption) for males compared to females**

* relative risk = 0.8888/0.8359 = 1.06

* odds for males = 0.8888/(1-0.8888) = 7.99

* odds for females = 0.8359/(1-0.8359) = 5.09

* odds ratio = 7.99/5.09 = 1.56

The calculated relative risk of 1.06 suggests that males have a 1.06 times higher risk of consuming alcohol compared to females. This indicates a slightly higher prevalence of alcohol consumption among males, although the difference is not substantial.

The odds ratio is 1.56, indicating that males have 1.56 times higher odds of consuming alcohol compared to females. This suggests a moderate association between gender and alcohol consumption, with males having higher odds of being alcohol consumers compared to females.


Based on the data, it can be concluded that there is a moderate association between gender and alcohol consumption. Males have a slightly higher prevalence and odds of consuming alcohol compared to females. The findings emphasize the need for comprehensive alcohol-related interventions and education for both genders to promote responsible alcohol consumption and address potential health risks associated with excessive alcohol use.


#### Chi-squared test
```{r,echo = FALSE, warning=FALSE,message=FALSE}
q6<- n1 |> dplyr::select(q14,q52)|> # Select the variables of interest
  table() # Create a contingency table

chisq.test(q6) # Perform the chi-squared test
```



### 11. What percentage of the population consumes alcohol, and how does this vary by socioeconomic status?

```{r, echo = FALSE, warning=FALSE,message=FALSE}

s11 <- n1 %>% 
  dplyr::group_by(q14, key1) %>% 
  dplyr::summarise(count = n()) |>
  drop_na() |>
  ungroup() %>%
  group_by(key1) %>%
  dplyr::mutate(perc = count/sum(count)*100) %>%
  dplyr::select(key1, q14, count)


drinking_by_sec <- 
  s11 %>% 
  group_by(key1, q14) %>% 
  dplyr::summarise(count = sum(count)) %>% 
  ungroup() %>% 
  group_by(key1) %>% 
  dplyr::summarise(perc = count*100/sum(count),
                   q14 = q14) %>% 
  arrange(key1)


# Plot the results
ggplot(drinking_by_sec, aes(x = key1, y = perc, fill = q14)) +
  geom_bar(stat = "identity") +
  scale_fill_discrete(name = "Do you consume alcohol?") +
  labs(x = "Socioeconomic status", y = "Percentage")+
  theme(axis.text.x = element_text(angle = 90))+scale_x_discrete(labels = function(x) 
    stringr::str_wrap(x, width = 15))+
  ggtitle ( "Alcohol consumption by socioeconomic status")
```


The data shows the varying patterns of alcohol consumption among different social economic groups. Here are some key observations:

1. Employers and Managers (Group A) have a high percentage (90.56%) of individuals consuming alcohol, while a relatively lower percentage (9.44%) do not consume alcohol.

2. Higher Professional (Group B) also has a high percentage (90.91%) of individuals consuming alcohol, with a similar pattern as Group A.

3. The percentage of alcohol consumers gradually decreases in subsequent groups such as Lower Professional (Group C), Non-Manual (Group D), Manual Skilled (Group E), Semi-Skilled (Group F), Unskilled (Group G), Own Account Workers (Group H), Farmers (Group I), Agricultural Workers (Group J), and All others gainfully occupied and unknown (Group Z).

4. Among Agricultural Workers (Group J), the percentage of alcohol consumers (73.68%) is relatively lower compared to other groups.

These findings suggest that there are variations in alcohol consumption patterns across different social economic groups. Factors such as occupation, income, and social status may influence these patterns. 


**calculating relative risk and an odds ratio (Alcohol consumption) for Employers and Managers compared to Agricultural Workers**

* relative risk = 0.9056/0.7368 = 1.06

* odds for Employers and Managers = 0.9056/(1-0.9056) = 9.59

* odds for Agricultural Workers = 0.7368/(1-0.7368) = 2.79

* odds ratio = 9.59/2.79 = 3.43


The calculated relative risk of 1.06 suggests that Employers and Managers have a 1.06 times higher risk of consuming alcohol compared to Agricultural Workers. This indicates a slightly higher prevalence of alcohol consumption among Employers and Managers, although the difference is not substantial.

The odds ratio is 3.43, indicating that Employers and Managers have 3.43 times higher odds of consuming alcohol compared to Agricultural Workers. This suggests a moderate association between occupational group and alcohol consumption, with Employers and Managers having higher odds of being alcohol consumers compared to Agricultural Workers.


Based on the data, it can be concluded that there is a moderate association between occupational group and alcohol consumption. These findings highlight the importance of considering occupational factors when addressing alcohol consumption patterns and implementing workplace wellness programs that promote responsible drinking behavior. It is essential to provide resources, support, and education on alcohol consumption within different occupational settings to ensure the well-being and safety of all individuals.


#### Chi-squared test
```{r,echo = FALSE, warning=FALSE,message=FALSE}
q7<- n1 |> dplyr::select(q14,key1)|> # Select the variables of interest
  table() # Create a contingency table

chisq.test(q7) # Perform the chi-squared test
```



### 12. What are the patterns of alcohol consumption across different local health offices (LHOs) within each county?

```{r, echo = FALSE, warning=FALSE,message=FALSE}

s12 <- n1 %>% 
  dplyr::group_by(q14, lho) %>% 
  dplyr::summarise(count = n()) |>
  drop_na() |>
  ungroup() %>%
  group_by(lho) %>%
  dplyr::mutate(perc = count/sum(count)*100) %>%
  dplyr::select(lho, q14, count)


drinking_by_region <- 
  s12 %>% 
  group_by(lho, q14) %>% 
  dplyr::summarise(count = sum(count)) %>% 
  ungroup() %>% 
  group_by(lho) %>% 
  dplyr::summarise(perc = count*100/sum(count),
                   q14 = q14) %>% 
  arrange(lho)
 

# Plot the results
ggplot(drinking_by_region, aes(x = lho, y = perc, fill = q14)) +
  geom_bar(stat = "identity") +
  scale_fill_discrete(name = "Do you consume alcohol?") +
  labs(x = "Age", y = "Percentage")+
  theme(axis.text.x = element_text(angle = 90,hjust=1))+
  ggtitle ( "Alcohol consumption by region")
```


The graph provides information on alcohol consumption patterns in different Local Health Offices (LHOs).

1. The percentage of individuals who do not consume alcohol varies across LHOs, ranging from as low as 4.50% (Dublin South East) to as high as 27.51% (Sligo/Leitrim/West Cavan). The majority of LHOs have a lower percentage of non-alcohol consumers, indicating a higher prevalence of alcohol consumption.

2. The percentage of individuals who consume alcohol also varies across LHOs, ranging from 72.49% (Sligo/Leitrim/West Cavan) to 95.50% (Dublin South East). This suggests that there are variations in alcohol consumption rates among different areas.

3. Some LHOs, such as Cavan/Monaghan, Dublin North Central, Dublin West, Dun Laoghaire, Kerry, Meath, and West Cork, have a higher percentage of individuals who consume alcohol, exceeding 90%.

4. LHOs like Dublin South East, Wicklow, and Louth have a relatively lower percentage of alcohol consumers, below 10%.

The prevalence of alcohol consumption in LHOs can help inform public health initiatives and interventions tailored to specific areas. LHOs with higher alcohol consumption rates might benefit from targeted programs addressing alcohol-related issues and promoting responsible drinking habits.


**calculating relative risk and an odds ratio (Alcohol consumption) for Dublin South East compared to Limerick**

* relative risk = 0.9549/0.8544 = 1.26

* odds for Dublin South East = 0.9549/(1-0.9549) = 21.17

* odds for Limerick = 0.8544/(1-0.8544) = 5.86

* odds ratio = 21.17/5.86 = 3.61


The relative risk of 1.26 indicates that individuals in Dublin South East have a 1.26 times higher risk of consuming alcohol compared to those in Limerick. This suggests a slightly higher prevalence of alcohol consumption in Dublin South East.

The odds ratio of 3.61 indicates that individuals in Dublin South East have 3.61 times higher odds of consuming alcohol compared to those in Limerick. This suggests a moderate association between the region and alcohol consumption, with Dublin South East having higher odds of alcohol consumption compared to Limerick.

Based on the data, it can be concluded that there is a moderate association between the geographic regions of Dublin South East and Limerick and alcohol consumption. Dublin South East has a slightly higher prevalence and significantly higher odds of alcohol consumption compared to Limerick. These findings highlight the importance of considering regional variations in alcohol consumption patterns and tailoring interventions and policies to address the specific needs and challenges of different areas. It is essential to promote responsible drinking behaviors and provide support and resources for individuals in both Dublin South East and Limerick to ensure the well-being and health of the population.


#### Chi-squared test
```{r,echo = FALSE, warning=FALSE,message=FALSE} 
q8<- n1 |> dplyr::select(q14,lho)|> # Select the variables of interest
  table() # Create a contingency table

chisq.test(q8) # Perform the chi-squared test
```



### 13. How does alcohol consumption vary among the surveyed individuals based on their country of birth?


```{r, echo = FALSE, warning=FALSE,message=FALSE}
s13 <- n1 %>% 
  dplyr::group_by(q14, countbirth) %>% 
  dplyr::summarise(count = n()) |>
  drop_na() |>
  ungroup() %>%
  group_by(countbirth) %>%
  dplyr::mutate(perc = count/sum(count)*100) %>%
  dplyr::select(countbirth, q14, count)


drinking_by_country <- 
  s13 %>% 
  group_by(countbirth, q14) %>% 
  dplyr::summarise(count = sum(count)) %>% 
  ungroup() %>% 
  group_by(countbirth) %>% 
  dplyr::summarise(perc = count*100/sum(count),
                   q14 = q14) %>% 
  arrange(countbirth)


# Plot the results
ggplot(drinking_by_country, aes(x = countbirth, y = perc, fill = q14)) +
  geom_bar(stat = "identity") +
  scale_fill_discrete(name = "Do you Consume Alcohol?") +
  labs(x = "County", y = "Percentage")+
  theme(axis.text.x = element_text(angle = 30,hjust=1))+
  ggtitle ("Variations in Alcohol Consumption Based on Country of Birth")
```



The graph displays the alcohol consumption rates based on the country of birth.

1. Alcohol Consumption Rates by Country of Birth: The table presents the alcohol consumption rates among individuals based on their country of birth. For example, among individuals born in Ireland, 86.53% consume alcohol, while among those born in the UK, the consumption rate is 90.43%. These rates vary based on the country of birth, indicating differences in alcohol consumption behaviors among different populations.

2. Variation in Alcohol Consumption Rates: The data reveals significant variations in alcohol consumption rates based on the country of birth. For instance, individuals born in the Rest of the World have a lower alcohol consumption rate of 67.37%, while those born in the Rest of EU have a higher rate of 87.29%. These disparities suggest that cultural and demographic factors associated with the country of birth may influence alcohol consumption behaviors.

3. Comparison by Country of Birth: The table allows for a comparison of alcohol consumption rates among individuals from different countries. For example, individuals born in Ireland have a relatively high alcohol consumption rate of 86.53%, whereas individuals born in the Rest of the World exhibit a lower consumption rate of 67.37%.

Understanding these variations in alcohol consumption rates can inform the development of targeted interventions and tailored alcohol awareness programs for specific populations. It underscores the significance of considering cultural and demographic factors associated with the country of birth when addressing alcohol consumption behaviors.


**calculating relative risk and an odds ratio (Alcohol Consumption) for Ireland compared to Rest of EU**

* relative risk = 0.8653/0.8728 = 0.99


* odds for Ireland = 0.8653/(1-0.8653) = 6.42

* odds for Rest of EU = 0.8728/(1-0.8728) = 6.86 

* odds ratio = 6.42/6.86 = 0.93


The relative risk compares the risk of alcohol consumption between Ireland and the Rest of the EU. A relative risk of 0.99 suggests that individuals in Ireland have a similar risk of alcohol consumption compared to individuals in the Rest of the EU. This indicates that alcohol consumption rates are comparable between Ireland and the Rest of the EU.

The odds ratio compares the odds of alcohol consumption between Ireland and the Rest of the EU. An odds ratio of 0.93 means that the odds of alcohol consumption in Ireland are 0.93 times lower than the odds of alcohol consumption in the Rest of the EU. This suggests that individuals in Ireland have slightly lower odds of being alcohol consumers compared to individuals in the Rest of the EU.

These findings indicate that there is no significant difference in alcohol consumption rates between Ireland and the Rest of the EU. The prevalence of alcohol consumption seems to be similar in both populations.


Understanding the factors influencing alcohol consumption behaviors is essential for public health interventions and policies aimed at promoting responsible drinking and reducing alcohol-related harms. Continued monitoring and evaluation of alcohol consumption trends can inform targeted interventions and strategies to address alcohol misuse and promote healthier behaviors.

### 14. How does the distribution of alcohol consumption vary among different age classes and genders in relation to health conditions?


```{r, echo = FALSE, warning=FALSE,message=FALSE}
s14 <- n1[c("q14", "ageclass", "q52", "spq1")]


# Calculate the percentage of smoking by 
h1 <- s14 %>%
  group_by(q14,ageclass,q52,spq1) %>%
  drop_na() |>
  dplyr::summarize(count = n()) %>%
  ungroup() %>%
  group_by(q14,q52,ageclass) %>%
  dplyr::mutate(perc = count*100/sum(count),q14=q14) 


# Plot the results
ggplot(h1, aes(x = ageclass, y = perc, fill = spq1)) +
  geom_bar(stat = "identity") +
  scale_fill_discrete(name = "Health condition") +
  labs(x = "Age", y = "Percentage")+
  ggtitle("Distribution of Health Conditions and Alcohol Consumption by Age and Gender")+
  guides(color = guide_legend(reverse = TRUE))+
  theme(axis.text.x = element_text(angle = 30,hjust=1))+
  facet_grid(~(q14)+ ~(q52),labeller = label_both)

```


The analysis examined the relationship between alcohol consumption and health conditions, specifically comparing individuals who consume alcohol to those who do not. The findings are as follows:


1. **Age Group: 15-24 years:**

   a) **Male:**
   
   * Non-consumers (No): Only 1.64% of males in this age group reported bad health conditions. This indicates that the majority of non-drinkers in this age range maintain good or very good health.
   
   * Consumers (Yes): Among the male drinkers, 7.20% reported bad health conditions. However, a significant portion (59.85%) reported very good health conditions. This suggests that while some drinkers face negative health effects, a considerable number still maintain good health.

   b) **Female:**
   
   * Non-consumers (No): 3.75% of females who don't consume alcohol reported bad health conditions. Similar to males, most non-drinkers in this age group experience good or very good health.
   
   * Consumers (Yes): Among female drinkers, 6.91% reported bad health conditions. However, a higher percentage (63.59%) reported very good health conditions. This implies that despite some negative health outcomes, a significant proportion of female drinkers still enjoy good overall health.
   

2. **Age Group: 25-44 years:**

   a) **Male:**
   
   * Non-consumers (No): 18.31% of non-drinking males reported bad health conditions, which is significantly higher than in the previous age group. This indicates a higher prevalence of health issues among non-drinkers in this age range.
   
   * Consumers (Yes): Among male drinkers, 8.28% reported bad health conditions, while 60.77% reported very good health conditions. This suggests that while there are some negative health consequences associated with alcohol consumption, a significant portion of male drinkers still maintain very good health.


   b) **Female:**
   
   * Non-consumers (No): 10.46% of females who abstain from alcohol reported bad health conditions, which is lower than the rate among non-drinking males but still relatively high compared to the younger age group.
   
   * Consumers (Yes): Among female drinkers, 8.11% reported bad health conditions, while 32.07% reported very good health conditions. This indicates that despite some negative health effects, a considerable proportion of female drinkers still enjoy good overall health.


3. **Age Group: 45-64 years:**

   a) **Male:**
   
   * Non-consumers (No): The percentage of non-drinking males reporting bad health conditions further increases to 27.12%. This suggests a higher prevalence of health issues among non-drinkers in this age group.
   
   * Consumers (Yes): Among male drinkers, 20.73% reported bad health conditions, while 36.60% reported very good health conditions. This indicates that while there are some negative health consequences associated with alcohol consumption, a significant proportion of male drinkers still maintain very good health.
   

   b) **Female:**
   
   * Non-consumers (No): 28.21% of females who abstain from alcohol reported bad health conditions, indicating a relatively high prevalence of health issues among non-drinkers.
   
   * Consumers (Yes): Among female drinkers, 14.24% reported bad health conditions, while 46.21% reported very good health conditions. This suggests that despite some negative health effects, a considerable proportion of female drinkers still enjoy good overall health.


4. **Age Group: 65 and over:**

   a) **Male:**
   
   * Non-consumers (No): 32.33% of non-drinking males reported bad health conditions, indicating a high prevalence of health issues among this group.
   
   * Consumers (Yes): Among male drinkers, 32.66% reported bad health conditions, while 48.57% reported very good health conditions. This suggests that while there are negative health consequences associated with alcohol consumption, a considerable proportion of male drinkers still maintain very good health.

   b) **Female:**
   
   * Non-consumers (No): 36.30% of females who abstain from alcohol reported bad health conditions, which is higher than the rate among non-drinking males.
   
   * Consumers (Yes): Among female drinkers, 26.46% reported bad health conditions, while 47.32% reported very good health conditions. This indicates that despite some negative health effects, a significant proportion of female drinkers still enjoy good overall health.


   **Conclusion:** 
   
* In the 15-24 age group, both male and female non-drinkers generally maintain good health. While some negative health effects are observed among drinkers, a considerable number of individuals, especially females, still report very good health conditions despite alcohol consumption.
   
* In the 25-44 age group, non-drinking males have a higher prevalence of health issues compared to non-drinking females. However, both male and female drinkers in this age range exhibit a similar pattern, with a portion facing negative health effects but a substantial number maintaining very good health conditions.
   
* In the 45-64 age group, both non-drinking males and females have a higher prevalence of health issues compared to younger age groups. However, among drinkers, a significant proportion still maintains very good health, especially among females.
   
   
* In the 65 and over age group, both non-drinking males and females exhibit a high prevalence of health issues. However, among drinkers, a considerable proportion still maintains very good health, suggesting that moderate alcohol consumption may not significantly compromise overall health in this age group.

Overall, the analysis shows that while alcohol consumption can lead to some negative health effects, a considerable proportion of individuals across different age groups still maintain good or very good health despite drinking. It's important to note that moderation and individual factors play a significant role in the overall impact of alcohol on health. These findings highlight the need for responsible alcohol consumption and personalized health considerations when assessing the relationship between alcohol and health outcomes.



### 15. In the last 12 months, how often have you consumed alcoholic beverages and have a private health insurance?

```{r, echo = FALSE, warning=FALSE,message=FALSE}
s15 <- n1[c("q14", "q52", "ageclass", "q55")]

# Calculate the percentage of alcoholic by 
health_ins_al <- s15 %>%
  group_by(q14,q52,ageclass,q55) %>%
  drop_na() |>
  dplyr::summarize(count = n()) %>%
  ungroup() %>%
  group_by(q14,q52,ageclass) %>%
  dplyr::mutate(perc = count*100/sum(count)) 


# Plot the results
ggplot(health_ins_al, aes(x = ageclass, y = perc, fill=q55)) +
  geom_bar(stat = "identity") +
  scale_fill_discrete(name = "Do you have private health insurance?") +
  labs(x = "Age", y = "Percentage")+
  ggtitle("Health Insurance for People consume alcohol")+
  guides(color = guide_legend(reverse = TRUE))+
  theme(axis.text.x = element_text(angle = 90,hjust=1))+
  facet_grid(~q14+q52,labeller = label_both)

```



The breakdown of the consumption of alcohol (q14), private health insurance (q55), by gender (q52), and age class (AGECLASS):


1. **Gender: Female, Age Class: 15-24 years**:

   * Among females aged 15-24 years, 2.50% have private health insurance, while 97.50% do not have private health insurance.
  
   * Regarding alcohol consumption, 66.67% of females in this age group consume alcohol, and 33.33% do not consume alcohol.


2. **Gender: Male, Age Class: 15-24 years**:

   * Among males aged 15-24 years, 3.45% have private health insurance, while 96.55% do not have private health insurance.
 
   * Regarding alcohol consumption, 91.24% of males in this age group consume alcohol, and 8.76% do not consume alcohol.


3. **Gender: Female, Age Class: 25-44 years**:
   
   * Among females aged 25-44 years, 18.54% have private health insurance, while 81.46% do not have private health insurance.
  
   * Regarding alcohol consumption, 59.24% of females in this age group consume alcohol, and 40.76% do not consume alcohol.


4. **Gender: Male, Age Class: 25-44 years**:

   * Among males aged 25-44 years, 12.93% have private health insurance, while 87.07% do not have private health insurance.
  
   * Regarding alcohol consumption, 92.15% of males in this age group consume alcohol, and 7.85% do not consume alcohol.


5. **Gender: Female, Age Class: 45-64 years**:
   
   * Among females aged 45-64 years, 21.17% have private health insurance, while 78.83% do not have private health insurance.
  
   * Regarding alcohol consumption, 88.39% of females in this age group consume alcohol, and 11.61% do not consume alcohol.


6. **Gender: Male, Age Class: 45-64 years**:

   * Among males aged 45-64 years, 15.44% have private health insurance, while 84.56% do not have private health insurance.
  
   * Regarding alcohol consumption, 88.39% of males in this age group consume alcohol, and 11.61% do not consume alcohol.


7. **Gender: Female, Age Class: 65 and over**:

   * Among females aged 65 and over, 14.07% have private health insurance, while 85.93% do not have private health insurance.
  
   * Regarding alcohol consumption, 81.28% of females in this age group consume alcohol, and 18.72% do not consume alcohol.


8. **Gender: Male, Age Class: 65 and over**:

   * Among males aged 65 and over, 11.88% have private health insurance, while 88.12% do not have private health insurance.
  
   * Regarding alcohol consumption, 81.28% of males in this age group consume alcohol, and 18.72% do not consume alcohol.



### 16. What is the relationship between the prevalence of consumption of alcohol among the surveyed individuals based on their age group and their status as the Chief Income Earner in their household?


```{r, echo = FALSE, warning=FALSE,message=FALSE}
s16 <- n1[c("q14", "ageclass", "q63b")]

income1 <- s16 %>%
  group_by(ageclass,q63b,q14) %>%
  drop_na() |>
  dplyr::summarize(count = n()) %>%
  ungroup() %>%
  group_by(ageclass,q63b) %>%
  dplyr::mutate(perc = count*100/sum(count),q14=q14) 


ggplot(income1, aes(x = ageclass, y = perc, fill=q14)) +
  geom_bar(stat = "identity") +
  scale_fill_discrete(name = "Do You consume alcohol") +
  labs(x = "Age", y = "Percentage")+
  ggtitle("Chief Income Earner")+
  guides(color = guide_legend(reverse = TRUE))+
  theme(axis.text.x = element_text(angle = 30,hjust=1))+
  facet_wrap(~q63b,labeller = label_both)

```



Based on the breakdown of being the Chief Income Earner in the household (q63b) by age class (AGECLASS) and alcohol consumption (q14), let's provide a detailed explanation and conclusion:

1. **Age Class: 15-24 years**:

   * Among individuals aged 15-24 years, a significant majority (91.24%) of those who are the Chief Income Earner consume alcohol.
   
   * The count for Chief Income Earners in this age group who consume alcohol is 125, while those who do not consume alcohol have a count of 12.
   
   * Among those who are not the Chief Income Earner, there is a higher count of individuals who consume alcohol (356) compared to those who do not (129).


2. **Age Class: 25-44 years**:

   * In the age group of 25-44 years, the majority (92.15%) of those who are the Chief Income Earner consume alcohol.
   
   * The count for Chief Income Earners in this age group who consume alcohol is 1597, while those who do not consume alcohol have a count of 136.
   
   * Among those who are not the Chief Income Earner, there is a higher count of individuals who consume alcohol (688) compared to those who do not (88).


3. **Age Class: 45-64 years**:

   * Among individuals aged 45-64 years, the majority (88.39%) of those who are the Chief Income Earner consume alcohol.
   
   * The count for Chief Income Earners in this age group who consume alcohol is 1622, while those who do not consume alcohol have a count of 213.
   
   * Among those who are not the Chief Income Earner, there is a higher count of individuals who consume alcohol (568) compared to those who do not (100).


4. **Age Class: 65 and over**:

   * In the age group of 65 and over, the majority (81.28%) of those who are the Chief Income Earner consume alcohol.
   
   * The count for Chief Income Earners in this age group who consume alcohol is 1433, while those who do not consume alcohol have a count of 330.
   
   * Among those who are not the Chief Income Earner, there is a higher count of individuals who consume alcohol (229) compared to those who do not (73).

Overall, the data shows that across all age classes, a higher percentage of individuals who are the Chief Income Earner in their household consume alcohol compared to those who do not. This trend is consistent across different age groups.

It's important to note that alcohol consumption can have various implications on individuals' health, finances, and overall well-being. Further analysis and consideration of these factors would be necessary to draw more comprehensive conclusions.


### 17. How does folic acid consumption vary across different regions in terms of percentages?

```{r, echo = FALSE, warning=FALSE,message=FALSE}
s17 <- n1[c("lho","q120")]

# Calculate the percentage by region
suppl <- s17 %>%
  group_by(lho,q120) %>%
  dplyr::summarise(count = n()) |>
  drop_na() |>
  ungroup() %>%
  group_by(lho) %>%
  dplyr::mutate(perc = count/sum(count)*100) %>%
  dplyr::select(lho, q120, count)

suppl$q120 <- ifelse(suppl$q120 %in% c("No", "Don’t know/refused"), "No", "Yes")


folic <- 
  suppl %>% 
  group_by(lho, q120) %>% 
  dplyr::summarise(count = sum(count)) %>% 
  ungroup() %>% 
  group_by(lho) %>% 
  dplyr::summarise(perc = count*100/sum(count),
                   q120 = q120) %>% 
  arrange(lho)


# Plot the results
ggplot(folic, aes(x = lho, y = perc, fill = q120)) +
  geom_bar(stat = "identity") +
  scale_fill_discrete(name = "Do you take folicacid suppliments?") +
  labs(x = "Age", y = "Percentage")+
  theme(axis.text.x = element_text(angle = 90,hjust=1))+
  ggtitle ( "Folic acid consumption by region")
```



1. Regional Variations: There are notable differences in folic acid consumption rates across different regions. Some regions have a higher percentage of individuals consuming folic acid supplements, while others have lower percentages. This suggests that there may be variations in awareness, accessibility, or cultural factors influencing folic acid consumption.

2. High Consumption Regions: Some regions stand out for their relatively high folic acid consumption rates. For example, regions like Tipperary South, Longford/Westmeath, and North Cork have higher percentages of individuals taking folic acid supplements. This indicates a positive trend in these regions and suggests the presence of effective health promotion efforts or prenatal care initiatives.

3. Low Consumption Regions: Conversely, there are regions with lower folic acid consumption rates. For instance, regions like Louth, Meath, and Dublin South East have relatively lower percentages of individuals taking folic acid supplements. This highlights areas where there might be a need for increased awareness campaigns and targeted interventions to promote folic acid supplementation during pregnancy.

4. Regional Disparities: The data reveals regional disparities in folic acid consumption. It is important to address these disparities to ensure equitable access to prenatal care and reduce the risk of birth defects. Targeted interventions and educational campaigns can be designed to raise awareness and encourage folic acid supplementation in regions with lower consumption rates.

In conclusion, the analysis of folic acid consumption by region provides valuable insights into the prevalence and regional variations of folic acid supplementation. This information can guide public health strategies and interventions aimed at improving folic acid awareness, accessibility, and uptake, ultimately contributing to better maternal and child health outcomes.



**calculating relative risk and an odds ratio (Folic acid consumption) for Meath compared to Galway**

* relative risk = 0.1052/0.0682 = 1.54

* odds for Meath = 0.1052/(1-0.1052) = 0.11

* odds for Galway = 0.0682/(1-0.0682) = 0.07

* odds ratio = 0.11/0.07 = 1.57


Based on the data, the relative risk of folic acid consumption in Meath compared to Galway is 1.54. This indicates that individuals in Meath have a 1.54 times higher risk of consuming folic acid supplements compared to individuals in Galway.

The odds for folic acid consumption in Meath are 0.11, meaning that the odds of individuals in Meath taking folic acid supplements are 0.11 times the odds of not taking them. In comparison, the odds for folic acid consumption in Galway are 0.07, indicating that the odds of individuals in Galway taking folic acid supplements are 0.07 times the odds of not taking them.

The odds ratio for Meath compared to Galway is 1.57. This means that individuals in Meath have 1.57 times higher odds of consuming folic acid supplements compared to individuals in Galway.

In conclusion, the calculations suggest that there is a higher prevalence of folic acid consumption in Meath compared to Galway. The relative risk, odds ratio, and odds values support the notion that individuals in Meath are more likely to consume folic acid supplements. These findings can guide public health initiatives and interventions to target regions with lower folic acid consumption, such as Galway, in order to improve awareness and accessibility to folic acid supplementation.





### 18. How do individuals rate their own health in general, and are there differences between genders and lhos?


```{r, echo = FALSE, warning=FALSE,message=FALSE}
s18 <- n1 %>% 
  dplyr::group_by(spq1, q52, lho) %>% 
  dplyr::summarise(count = n()) |>
  drop_na() |>
  ungroup() %>%
  group_by(spq1) %>%
  dplyr::mutate(perc = count/sum(count)*100) %>%
  dplyr::select(spq1, q52, lho, count)


health <- 
  s18 %>% 
  group_by(spq1, q52,lho) %>% 
  dplyr::summarise(count = sum(count)) %>% 
  ungroup() %>% 
  group_by(lho,q52) %>% 
  dplyr::summarise(spq1=spq1,
                   perc = count*100/sum(count)) %>% 
  arrange(lho)


# Plot the results
ggplot(health, aes(x = q52, y = perc, fill = spq1)) +
  geom_bar(stat = "identity")  +
  labs(x = "Gender", y = "Proportion", fill = "Health Status")+
  ggtitle("Proportion of Individuals Rating Their Health by Gender in various Counties")+
  facet_wrap(~lho)

```


Based on the breakdown of self-perceived health (spq1) by age class (AGECLASS), gender (q52), and the corresponding percentages, a detailed explanation is provided below:

1. **Age Class: 15-24 years**:
   
   * Among individuals aged 15-24 years, the majority of males (62.15%) and females (66.67%) perceive their health as "Very Good."
 
   * A smaller percentage of males (31.69%) and females (27.27%) perceive their health as "Good."
 
   * A minority of males (6.15%) and females (6.06%) perceive their health as "Bad."


2. **Age Class: 25-44 years**:

   * In the age group of 25-44 years, a significant portion of males (60.27%) and females (59.24%) perceive their health as "Very Good."
  
   * A considerable percentage of males (30.76%) and females (32.40%) perceive their health as "Good."
  
   * A smaller proportion of males (8.97%) and females (8.36%) perceive their health as "Bad."


3. **Age Class: 45-64 years**:

   * Among individuals aged 45-64 years, a notable percentage of males (42.28%) and females (43.98%) perceive their health as "Very Good."
 
   * A considerable portion of males (36.31%) and females (39.83%) perceive their health as "Good."
  
   * A significant proportion of males (21.41%) and females (16.19%) perceive their health as "Bad."


4. **Age Class: 65 and over**:

   * In the age group of 65 and over, a significant portion of males (47.79%) and females (46.79%) perceive their health as "Good."
  
   * A notable percentage of males (32.62%) and females (28.90%) perceive their health as "Bad."
  
   * A smaller proportion of males (19.59%) and females (24.31%) perceive their health as "Very Good."


Overall, the data suggests that there is a trend of higher perceived health as individuals age, with a higher percentage of individuals perceiving their health as "Very Good" in older age groups. Additionally, the data indicates that females tend to have slightly higher percentages of perceiving their health as "Good" and "Very Good" compared to males across most age groups. Further analysis and exploration can provide insights into the factors influencing self-rated health, such as underlying health conditions, lifestyle factors, and access to healthcare.



### Models

```{r}
library(dplyr)
library(caret)
library(randomForest)

example_dat <- n1 %>% dplyr::select(q6, ageclass, q52)
example_dat <- example_dat %>% drop_na(q6) %>% mutate(q6_binary = (as.factor(q6)), ageclass = as.factor(ageclass))

# Convert q6_binary to a factor
example_dat$q6_binary <- factor(example_dat$q6_binary, levels = c("No", "Yes"))

# Create a training and testing dataset
set.seed(123)
trainIndex <- createDataPartition(example_dat$q6_binary, p = 0.7, list = FALSE)
train_data <- example_dat[trainIndex, ]
test_data <- example_dat[-trainIndex, ]

# Handle missing values in the training and testing data
train_data <- na.omit(train_data)
test_data <- na.omit(test_data)

# Fit the Random Forest model
random_forest <- randomForest(q6_binary ~ ageclass + q52, data = train_data, ntree = 100)
random_forest
# Predict using the Random Forest model
predicted_classes <- predict(random_forest, newdata = test_data)

# Convert predicted_classes to a factor with the same levels as test_data$q6_binary
predicted_classes <- factor(predicted_classes, levels = c("No", "Yes"))

# Create the confusion matrix
confusion_matrix <- table(predicted_classes, test_data$q6_binary)

# Calculate accuracy
accuracy <- sum(diag(confusion_matrix)) / sum(confusion_matrix)

# Print accuracy
print(paste("Accuracy:", round(accuracy * 100, 2), "%"))

```




### 1. Logistic Regression
```{r}
example_dat <- n1 %>% dplyr::select(q6,ageclass,q52)
  
  
#example_dat$q6 <-   ifelse(example_dat$q6 %in% c("Yes, daily", "Yes, occasionally"), "Yes", "No") 

example_dat <- example_dat %>% drop_na(q6) %>% mutate(q6_binary = as.numeric(as.factor(q6)) -1)
#example_dat <- example_dat %>% drop_na(q6) %>% mutate(q6_binary = (as.factor(q6)), ageclass = as.factor(ageclass))

logistic_mod <- glm(q6_binary ~ ageclass + q52, data = example_dat, family = "binomial")
logistic_mod


```




```{r}
example_dat <- n1 %>% dplyr::select(q6,ageclass,q52)

  
example_dat$q6 <-   ifelse(example_dat$q6 %in% c("Yes, daily", "Yes, occasionally"), "Yes", "No") 

#example_dat <- example_dat %>% drop_na(q6) %>% mutate(q6_binary = as.numeric(as.factor(q6)) -1)

### making the predictors characters first and then factors preserves the labels when running the logistic regression
example_dat <- example_dat %>% drop_na(q6) %>% mutate(q6_binary = as.factor(q6), 
                                                      ageclass = as.factor(as.character(ageclass)),
                                                      q52 = as.factor(as.character(q52))) 


logistic_mod <- glm(q6_binary ~ ageclass + q52, data = example_dat, family = "binomial")
logistic_mod
```



```{r}
# Load required libraries
library(dplyr)
library(caret)

# Load the dataset and select relevant variables
example_dat <- n1 %>% dplyr::select(q6, ageclass, q52)

# Preprocess the data
example_dat <- example_dat  %>% mutate(q6_binary = 1*(q6 == "Yes") + 0)


example_dat <- example_dat %>% drop_na(q6) %>% mutate(                                                      ageclass = as.factor(as.character(ageclass)),
                                                      q52 = as.factor(as.character(q52)))

# Create a training and testing dataset
set.seed(123)
trainIndex <- createDataPartition(example_dat$q6_binary, p = 0.6, list = FALSE,times=1)
train_data <- example_dat[trainIndex, ]
test_data <- example_dat[-trainIndex, ]


# Fit the logistic regression model
logistic_mod <- glm(q6_binary ~ ageclass + q52, data = train_data, family = "binomial")

# Evaluate the model on the test dataset
predicted_classes <- ifelse(predict(logistic_mod, newdata = test_data, type = "response") > 0.5, "Yes", "No")

# Convert test_data$q6_binary to a factor with the same levels as predicted_classes
test_data$q6_binary <- factor(test_data$q6_binary, levels = c("Yes", "No"))

# Convert predicted_classes to a factor with the same levels as test_data$q6_binary
predicted_classes <- factor(predicted_classes, levels = c("Yes", "No"))

# Create the confusion matrix
confusion_matrix <- confusionMatrix(predicted_classes, test_data$q6_binary)

# Calculate accuracy
accuracy <- round(confusion_matrix$overall["Accuracy"], digits = 4)

# Print the model summary, accuracy, and confusion matrix
summary(logistic_mod)

print(paste("Accuracy:", accuracy * 100))
print(confusion_matrix)

```




#### Smoking
```{r}
library(dplyr)
library(caret)


example_dat <- n1 %>% dplyr::select(q6,ageclass,q52)

#example_dat <- example_dat %>% drop_na(q6) %>% mutate(q6_binary = as.numeric(as.factor(q6)) -1)

# Convert q6 to binary variable
#example_dat$q6 <- ifelse(example_dat$q6 %in% c("Yes, daily", "Yes, occasionally"), "Yes", "No")

# Convert variables to factors
example_dat <- example_dat %>% drop_na(q6) %>% mutate(q6_binary = as.factor(q6),
                                                      ageclass = as.factor(as.character(ageclass)),
                                                      q52 = as.factor(as.character(q52)))


# Create a training and testing dataset
set.seed(1234)
trainIndex <- createDataPartition(example_dat$q6_binary, p = 0.7, list = FALSE)
train_data <- example_dat[trainIndex, ]
test_data <- example_dat[-trainIndex, ]

# Fit the logistic regression model
logistic_mod <- glm(q6_binary ~ ageclass + q52, data = train_data, family = "binomial")

# Evaluate the model on the test dataset
predicted_classes <- ifelse(predict(logistic_mod, newdata = test_data, type = "response") > 0.5, "Yes", "No")


# Convert test_data$q6_binary to a factor with the same levels as predicted_classes
test_data$q6_binary <- factor(test_data$q6_binary, levels = c("Yes", "No"))

# Convert predicted_classes to a factor with the same levels as test_data$q6_binary
predicted_classes <- factor(predicted_classes, levels = c("Yes", "No"))


# Create the confusion matrix
confusion_matrix <- confusionMatrix(predicted_classes, test_data$q6_binary)

accuracy <- round(confusion_matrix$overall["Accuracy"], digits = 4)

# Print the model summary, accuracy, and confusion matrix
(logistic_mod)
print(paste("Accuracy:", accuracy*100))
print(confusion_matrix)

```




#### Alcohol
```{r}

example_dat <- n1 %>% dplyr::select(q14,ageclass,q52)

#example_dat <- example_dat %>% drop_na(q6) %>% mutate(q6_binary = as.numeric(as.factor(q6)) -1)

example_dat <- example_dat %>% drop_na(q14) %>% mutate(q14_binary = (as.factor(q14)), ageclass = as.factor(ageclass))

# Create a training and testing dataset
set.seed(123)
trainIndex <- createDataPartition(example_dat$q14_binary, p = 0.65, list = FALSE)
train_data <- example_dat[trainIndex, ]
test_data <- example_dat[-trainIndex, ]

# Fit the logistic regression model
logistic_mod1 <- glm(q14_binary ~ ageclass + q52, data = train_data, family = "binomial")

# Evaluate the model on the test dataset

predicted_classes <- ifelse(predict(logistic_mod1, newdata = test_data, type = "response") > 0.5, "Yes", "No")


# Convert test_data$q6_binary to a factor with the same levels as predicted_classes
test_data$q14_binary <- factor(test_data$q14_binary, levels = c("Yes", "No"))

# Convert predicted_classes to a factor with the same levels as test_data$q6_binary
predicted_classes <- factor(predicted_classes, levels = c("Yes", "No"))

# Create the confusion matrix
confusion_matrix <- confusionMatrix(predicted_classes, test_data$q14_binary)

accuracy <- round(confusion_matrix$overall["Accuracy"], digits = 4)


# Print the model summary, accuracy, and confusion matrix
logistic_mod1
print(paste("Accuracy:", accuracy*100))
print(confusion_matrix)


```



### 2. Decision Trees

#### Smoking
```{r}
library(rpart)

# Fit the decision tree model
#decision_tree <- rpart(q6_binary ~ ageclass + q52, data = train_data, method = "class")

# Predict the classes using the decision tree model
#predicted_classes_tree <- predict(decision_tree, newdata = test_data, type = "class")

# Create the confusion matrix
#confusion_matrix_tree <- confusionMatrix(predicted_classes_tree, test_data$q6_binary)

# Calculate accuracy
#accuracy_tree <- round(confusion_matrix_tree$overall["Accuracy"], digits = 4)

# Print the decision tree model, accuracy, and confusion matrix
#print(decision_tree)
#print(paste("Accuracy:", accuracy_tree * 100))
#print(confusion_matrix_tree)

```



#### Alcohol

```{r}
library(rpart)

set.seed(123)
trainIndex1 <- createDataPartition(example_dat$q14_binary, p = 0.7, list = FALSE)
train_data1 <- example_dat[trainIndex, ]
test_data1 <- example_dat[-trainIndex, ]


# Fit the decision tree model
decision_tree1 <- rpart(q14_binary ~ ageclass + q52, data = train_data, method = "class",control = rpart.control(cp = 0))

# Predict the classes using the decision tree model
predicted_classes_tree <- predict(decision_tree1, newdata = test_data, type = "class")

# Create the confusion matrix
confusion_matrix_tree <- confusionMatrix(predicted_classes_tree, test_data$q14_binary)

# Calculate accuracy
accuracy_tree <- round(confusion_matrix_tree$overall["Accuracy"], digits = 4)

# Print the decision tree model, accuracy, and confusion matrix
print(decision_tree1)
print(paste("Accuracy:", accuracy_tree * 100))
print(confusion_matrix_tree)

```


```{r}
library(rpart.plot)
rpart.plot(decision_tree1,extra= 106)
```
```{r}
train_data1$q14|> table()
```



```{r}
library(dplyr)
library(caret)
library(randomForest)

example_dat <- n1 %>% dplyr::select(q6, ageclass, q52)

example_dat <- example_dat %>% drop_na(q6) %>% mutate(q6_binary = (as.factor(q6)), ageclass = as.factor(ageclass))

# Create a training and testing dataset
set.seed(123)
trainIndex <- createDataPartition(example_dat$q6_binary, p = 0.7, list = FALSE)
train_data <- example_dat[trainIndex, ]
test_data <- example_dat[-trainIndex, ]

# Fit the logistic regression model
logistic_mod <- glm(q6_binary ~ ageclass + q52, data = train_data, family = "binomial")

# Evaluate the logistic regression model on the test dataset
predicted_classes_logistic <- ifelse(predict(logistic_mod, newdata = test_data, type = "response") > 0.5, "Yes", "No")

# Convert test_data$q6_binary to a factor with the same levels as predicted_classes_logistic
test_data$q6_binary <- factor(test_data$q6_binary, levels = c("Yes", "No"))

# Convert predicted_classes_logistic to a factor with the same levels as test_data$q6_binary
predicted_classes_logistic <- factor(predicted_classes_logistic, levels = c("Yes", "No"))

# Create the confusion matrix for logistic regression
confusion_matrix_logistic <- confusionMatrix(predicted_classes_logistic, test_data$q6_binary)

# Calculate accuracy for logistic regression
accuracy_logistic <- round(confusion_matrix_logistic$overall["Accuracy"], digits = 4)

# Print the logistic regression model summary, accuracy, and confusion matrix
print(logistic_mod)
print(paste("Logistic Regression Accuracy:", accuracy_logistic * 100))
print(confusion_matrix_logistic)

# Preprocess the data for Random Forest (handle missing values)
train_data_rf <- na.omit(train_data)
test_data_rf <- na.omit(test_data)

# Fit the Random Forest model
random_forest <- randomForest(q6_binary ~ ageclass + q52, data = train_data_rf, ntree = 100)

# Predict the classes using the Random Forest model
predicted_classes_forest <- predict(random_forest, newdata = test_data_rf, type = "class")

# Create the confusion matrix for Random Forest
confusion_matrix_forest <- confusionMatrix(predicted_classes_forest, test_data_rf$q6_binary)

# Calculate accuracy for Random Forest
accuracy_forest <- round(confusion_matrix_forest$overall["Accuracy"], digits = 4)

# Print the Random Forest model, accuracy, and confusion matrix
print(random_forest)
print(paste("Random Forest Accuracy:", accuracy_forest * 100))
print(confusion_matrix_forest)

```




### heatmap


```{r}
library(sf)

ireland_counties <- st_read("C:/Users/User/Music/Final Project/Healthy-Ireland/counties/counties.shx")


# Print attribute table
print(ireland_counties)

# Plot the counties
plot(ireland_counties)

```


```{r}

ireland_counties_final = subset(ireland_counties, select = c(OSM_ID,NAME_TAG,LATITUDE,LONGITUDE) )
```


```{r}
ireland_counties <- st_read("C:/Users/User/Music/Final Project/Healthy-Ireland/counties/counties.shx")
st_layers("C:/Users/User/Music/Final Project/Healthy-Ireland/counties/counties.shx")

```


```{r}
library(sf)
library(dplyr)
library(ggplot2)

ireland_counties <- st_read("C:/Users/User/Music/Final Project/Healthy-Ireland/counties/counties.shx")

# Join the smoking rates data with the spatial data
ireland_counties <- left_join(ireland_counties, smoking_by_region, by = c("COUNTY" = "lho"))


# Plot the map
ggplot() +
  geom_sf(data = ireland_counties, aes(fill = perc), color = "white") +
  scale_fill_gradient(low = "lightblue", high = "darkblue", name = "Percentage") +
  labs(title = "Smoking Rates in Various Regions", x = "Longitude", y = "Latitude") +
  theme_minimal()


```





```{r}
library(tidyverse)
library(rjags)
library(R2jags)
library(tidybayes)
library(bayesplot)
library(maps)
library(maptools)

## Get the data
library(SpatialEpi)

data(scotland)

lip_cancer_dat <- scotland$data
lip_cancer_dat <- lip_cancer_dat %>% mutate(SMR = cases/expected)

## JAGs model spec
bhpoismodel = "
model{
for(i in 1:n) {
# Poisson likelihood (data model)
y.i[i] ~ dpois(lambda.i[i])
lambda.i[i] <- theta.i[i]*e.i[i]

# prior for theta
theta.i[i] ~ dgamma(alpha,beta)
# Shrinkage factor
w.i[i] <- beta/(beta + e.i[i])
}
# Prior distributions for hyper parameters
alpha ~ dexp(0.1)
beta ~ dexp(0.1)
# store group mean and across-group variance
mtheta <- alpha/beta
sdtheta <- sqrt(alpha/(beta^2))
}
"
jags.data <- list(y.i = lip_cancer_dat$cases,
                  e.i = lip_cancer_dat$expected,
                  n = nrow(lip_cancer_dat))

parnames <- c("alpha","beta","mtheta","sdtheta","w.i","theta.i")

mod <- jags(data = jags.data, 
            parameters.to.save = parnames, 
            model.file = textConnection(bhpoismodel),
            n.iter = 6000,
            n.burnin = 2000,
            n.thin = 4)

m <- mod$BUGSoutput$sims.matrix

## summary for theta and shrinkage
index <- 1:nrow(lip_cancer_dat)
par_summary <- m %>% 
  gather_rvars(w.i[index],theta.i[index]) %>% 
  median_qi(.value)

## format for plotting
par_wide <- par_summary %>% 
  select(index, .variable, .value) %>% 
  pivot_wider(id_cols = index, 
              values_from = .value,
              names_from = .variable) %>% 
  mutate(SMR = lip_cancer_dat$SMR,
         expected = ifelse(lip_cancer_dat$expected<5,"< 5",">/= 5"))

prior_mean <- mod$BUGSoutput$mean$mtheta

p1 <- ggplot(par_wide, aes(x = SMR, y = theta.i)) +
  geom_point(aes(colour = expected)) +
  geom_line(aes(x = SMR, y = SMR)) +
  geom_segment(aes(x = 1.3, y = prior_mean, xend = 0, yend = prior_mean),
               arrow = arrow(length = unit(0.6, "cm"))) +
  annotate("text", x = 0.7, y = prior_mean + 0.4, label = "prior mean = 1.4")

p2 <- ggplot(par_wide, aes(x = lip_cancer_dat$expected, y = w.i)) +
  geom_point(aes(colour = expected)) +
  ylab("Shrinkage factor (w.i)") +
  xlab("Expected")

ggpubr::ggarrange(p1,p2, common.legend = T)

## MAPS
shapefile <- scotland$spatial.polygon

shapefile <- ireland_counties_final

#Reshape for ggplot2 using the Broom package
mapdata <- broom::tidy(shapefile) #This might take a few minutes
lip_cancer_dat <- lip_cancer_dat %>% 
  mutate(id =  mapdata$id %>% unique(),
         theta.i = mod$BUGSoutput$mean$theta.i)

#Join mydata with mapdata
df <- plyr::join(mapdata, lip_cancer_dat, by="id")


#Create the heatmap for observed SMR
gg1 <- ggplot() + 
        geom_polygon(data = df, 
                     aes(x = long, y = lat, group = group, fill = SMR), 
                     color = "#FFFFFF", size = 0.25) + 
        scale_fill_gradient(low = "yellow", high = "red", na.value = "white",limits = c(0,7))+
        coord_fixed(1)+
        theme_minimal() +
        theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
        theme(axis.title.x=element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank()) +
        theme(axis.title.y=element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())

#Create the heatmap for model estimates
gg2 <- ggplot() + 
        geom_polygon(data = df, 
                     aes(x = long, y = lat, group = group, fill = theta.i), 
                     color = "#FFFFFF", size = 0.25)+ 
        scale_fill_gradient(low = "yellow", high = "red", na.value = "white",limits = c(0,7))+
        coord_fixed(1)+
        theme_minimal() +
        theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
        theme(axis.title.x=element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank()) +
        theme(axis.title.y=element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())

ggpubr::ggarrange(gg1 + ggtitle("Raw SMR Estimates") ,gg2 + ggtitle("Model Estimates"))



# Model with predictor ----------------------------------------------------

bhpoismodel2 = "
model{
for(i in 1:n) {
# Poisson likelihood (data model)
y.i[i] ~ dpois(lambda.i[i])
lambda.i[i] <- theta.i[i]*e.i[i]

# prior for theta
#log(theta.i[i]) <- ltheta.i[i]

theta.i[i] <- exp(alpha.i[i] + beta*(x.i[i]-mean(x.i)))
alpha.i[i] ~ dnorm(mu_alpha, sigma_alpha^-2)

}
# Prior distributions for hyper parameters
mu_alpha ~ dnorm(0,10^-2)
beta ~ dnorm(0,10^-2)
sigma_alpha ~ dt(0,2^-2,1)T(0,)
}
"

jags.data <- list(y.i = lip_cancer_dat$cases,
                  e.i = lip_cancer_dat$expected,
                  n = nrow(lip_cancer_dat),
                  x.i = lip_cancer_dat$AFF)

parnames <- c("alpha.i","beta","mu_alpha","sigma_alpha","theta.i")

mod2 <- jags(data = jags.data, 
            parameters.to.save = parnames, 
            model.file = textConnection(bhpoismodel2),
            n.iter = 10000,
            n.burnin = 2000,
            n.thin = 4)

m2 <- mod2$BUGSoutput$sims.matrix

## Look at alpha
alpha_ind <- 1:jags.data$n
alpha_samps2 <- m2 %>% spread_draws(alpha.i[alpha_ind]) %>% 
  dplyr::select(alpha_ind, alpha.i) %>% dplyr::ungroup() %>% 
  dplyr::mutate(alpha_ind = factor(alpha_ind, labels = lip_cancer_dat$county.names),
                exp_alpha.i = exp(alpha.i))

colour_e <- ifelse(lip_cancer_dat$expected<5,"red","yellow")

ggplot(alpha_samps2, aes(x = alpha_ind, y = exp_alpha.i)) +
  geom_boxplot(colour = colour_e,outlier.shape = NA) +
  geom_hline(yintercept = exp(mod2$BUGSoutput$mean$mu_alpha))+
  theme_classic() +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1)) +
  xlab("") +
  ylab("exp(alpha.i)")

## Look at theta
theta_ind <- 1:jags.data$n
theta_samps2 <- m2 %>% spread_draws(theta.i[theta_ind]) %>% 
  dplyr::select(theta_ind, theta.i) %>% dplyr::ungroup() %>% 
  dplyr::mutate(theta_ind = factor(theta_ind, labels = lip_cancer_dat$county.names))

ggplot(theta_samps2, aes(x = theta_ind, y = theta.i)) +
  geom_boxplot(colour = colour_e,outlier.shape = NA) +
  geom_point(data = lip_cancer_dat, aes(x = theta_ind, y = SMR, colour = "observed SMR")) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1)) +
  xlab("") +
  labs(colour = "") +
  ylab("theta.i")

### MAP

#Reshape for ggplot2 using the Broom package
mapdata <- broom::tidy(shapefile) #This might take a few minutes
lip_cancer_dat <- lip_cancer_dat %>% 
  mutate(theta.i_mod2 = mod2$BUGSoutput$mean$theta.i)

#Join mydata with mapdata
df <- plyr::join(mapdata, lip_cancer_dat, by="id")

#Create the heatmap using the ggplot2 package
gg3 <- ggplot() + geom_polygon(data = df, aes(x = long, y = lat, group = group, fill = theta.i_mod2), color = "#FFFFFF", size = 0.25)+ 
  scale_fill_gradient(low = "yellow", high = "red", na.value = "white",limits = c(0,7))+
  coord_fixed(1)+
  theme_minimal() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  theme(axis.title.x=element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank()) +
  theme(axis.title.y=element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank()) +
  ggtitle("with predictor")

#Create the heatmap using the ggplot2 package
gg4 <- ggplot() + geom_polygon(data = df, aes(x = long, y = lat, group = group, fill = AFF), color = "#FFFFFF", size = 0.25)+ 
  scale_fill_gradient(low = "green", high = "blue", na.value = "white",limits = c(0,0.3))+
  coord_fixed(1)+
  theme_minimal() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  theme(axis.title.x=element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank()) +
  theme(axis.title.y=element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank()) 


ggpubr::ggarrange(gg1 + ggtitle("Raw SMR"),gg2 + ggtitle("w/o predictor"),gg3, gg4)

```



### model - new


```{r}
library(tidyverse)
library(dplyr)
library(caret)
library(naivebayes)
library(dplyr)
library(ggplot2)
library(psych)
library(e1071)
library(xgboost)


# Select relevant variables
example_dat <- n1 %>% dplyr::select(q6, ageclass, q52,key1)

# Drop rows with missing values
example_dat <- example_dat %>% drop_na()

# Convert variables to appropriate data types
example_dat <- example_dat %>% mutate(q6_binary = as.factor(q6),
                                      ageclass = as.factor(as.character(ageclass)),
                                      q52 = as.factor(as.character(q52)),
                                      key1 = as.factor((as.character(key1))))

# Create a training and testing dataset
set.seed(123)
trainIndex <- createDataPartition(example_dat$q6_binary, p = 0.7, list = FALSE)
train_data <- example_dat[trainIndex, ]
test_data <- example_dat[-trainIndex, ]

# Fit logistic regression model
logistic_mod <- glm(q6_binary ~ ageclass + q52+key1, data = train_data, family = "binomial")

# Fit random forest model
random_forest <- randomForest(q6_binary ~ ageclass + q52+key1, data = train_data, ntree = 100)

# Fit decision tree model
decision_tree <- rpart(q6_binary ~ ageclass + q52+key1, data = train_data, method = "class")

# Fit Naive Bayes model
naive_bayes <- naive_bayes(q6_binary ~ ageclass + q52+key1, data = train_data)

# Fit SVM model
svm_model <- svm(q6_binary ~ ageclass + q52+key1, data = train_data, kernel = "linear")

```

#### naive bayes
```{r}
library(e1071)

# Predict the classes using the Naive Bayes model
predicted_classes <- predict(naive_bayes, newdata = test_data)

# Create the confusion matrix
confusion_matrix <- confusionMatrix(predicted_classes, test_data$q6_binary)

# Calculate accuracy
accuracy <- round(confusion_matrix$overall["Accuracy"], digits = 4)

# Print the accuracy and confusion matrix
print(paste("Accuracy:", accuracy * 100))
print(confusion_matrix)

summary(naive_bayes)
```


#### svm
```{r}
library(e1071)

# Predict the classes using the SVM model
predicted_classes <- predict(svm_model, newdata = test_data)

# Create the confusion matrix
confusion_matrix <- confusionMatrix(predicted_classes, test_data$q6_binary)

# Calculate accuracy
accuracy <- round(confusion_matrix$overall["Accuracy"], digits = 4)

# Print the accuracy and confusion matrix
print(paste("Accuracy:", accuracy * 100))
print(confusion_matrix)
summary(svm_model)
```


#### logistic 
```{r}
# Evaluate the model on the test dataset
predicted_classes <- ifelse(predict(logistic_mod, newdata = test_data, type = "response") > 0.5, "Yes", "No")

# Convert test_data$q6_binary to a factor with the same levels as predicted_classes
test_data$q6_binary <- factor(test_data$q6_binary, levels = c("Yes", "No"))

# Convert predicted_classes to a factor with the same levels as test_data$q6_binary
predicted_classes <- factor(predicted_classes, levels = c("Yes", "No"))

# Create the confusion matrix
confusion_matrix <- confusionMatrix(predicted_classes, test_data$q6_binary)

# Calculate accuracy
accuracy <- round(confusion_matrix$overall["Accuracy"], digits = 4)

# Print the model summary, accuracy, and confusion matrix
summary(logistic_mod)

print(paste("Accuracy:", accuracy * 100))
print(confusion_matrix)
```


#### decision tree

```{r}
library(rpart)
library(rpart.plot)
library(caret)


# Predict the classes using the decision tree model
predicted_classes <- predict(decision_tree, newdata = test_data, type = "class")

# Create the confusion matrix
confusion_matrix <- confusionMatrix(predicted_classes, test_data$q6_binary)

# Calculate accuracy
accuracy <- round(confusion_matrix$overall["Accuracy"], digits = 4)

# Print the accuracy and confusion matrix
print(paste("Accuracy:", accuracy * 100))
print(confusion_matrix)

```
```

